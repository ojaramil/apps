<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="MHM Mascota Multi - Veterinary Medical History - Manage up to 5 pets with bilingual support">
    <title>MHM Mascota Multi - Historia Médica Veterinaria</title>

    <!-- Styles -->
    <style>
        /* =============================================
   MHM MASCOTA - Historia Médica Veterinaria
   Estilo Premium UI para Mascotas
   ============================================= */

        /* --- CSS Variables / Design Tokens --- */
        :root {
            /* Colores principales - Paleta Veterinaria */
            --primary-green-dark: #1b5e20;
            --primary-green: #388e3c;
            --primary-green-light: #66bb6a;
            --accent-orange: #ff7043;
            --accent-orange-dark: #e64a19;
            --accent-brown: #795548;

            /* Fondos */
            --bg-gradient-start: #1b5e20;
            --bg-gradient-mid: #43a047;
            --bg-gradient-end: #81c784;

            /* Botones header */
            --btn-gradient-start: #fff8e1;
            --btn-gradient-end: #ffcc80;
            --btn-border: #fb8c00;

            /* Pestañas */
            --tab-bg: #c8e6c9;
            --tab-active-bg: #e8f5e9;
            --tab-border: #66bb6a;

            /* Formularios */
            --input-bg: #ffffff;
            --input-border: #a5d6a7;
            --input-shadow: rgba(0, 0, 0, 0.1);

            /* Texto */
            --text-dark: #1b5e20;
            --text-label: #2e7d32;
            --text-body: #333333;

            /* Fuentes */
            --font-main: 'Segoe UI', 'Roboto', Tahoma, sans-serif;

            /* Radios */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 20px;

            /* Sombras */
            --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 4px 8px rgba(0, 0, 0, 0.15);
            --shadow-heavy: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        /* --- Reset & Base --- */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: var(--text-body);
            background: linear-gradient(135deg,
                    var(--bg-gradient-start) 0%,
                    var(--bg-gradient-mid) 40%,
                    var(--bg-gradient-end) 100%);
            background-attachment: fixed;
            position: relative;
            overflow-x: hidden;
        }

        /* Decoración de fondo - Patitas */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(ellipse 80% 50% at 20% 80%, rgba(255, 255, 255, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 30%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse 100% 60% at 50% 100%, rgba(255, 255, 255, 0.06) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        /* --- Layout Container --- */
        .mhm-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 15px;
            position: relative;
            z-index: 1;
        }

        /* =============================================
   HEADER SECTION
   ============================================= */
        .mhm-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 15px;
        }

        /* Logo Section */
        .mhm-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mhm-logo-icon {
            position: relative;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mhm-logo-paw {
            font-size: 3.5rem;
            color: var(--accent-orange);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: pawPulse 2s ease-in-out infinite;
        }

        @keyframes pawPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .mhm-logo-text {
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .mhm-logo-title {
            font-size: 2.8rem;
            font-weight: bold;
            letter-spacing: -3px;
            margin: 0;
            line-height: 1;
        }

        .mhm-logo-subtitle {
            font-size: 0.9rem;
            font-style: italic;
            margin: 0;
            letter-spacing: 1px;
            color: #ffcc80;
        }

        /* Header Action Buttons */
        .mhm-header-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .mhm-btn {
            background: linear-gradient(180deg,
                    var(--btn-gradient-start) 0%,
                    var(--btn-gradient-end) 100%);
            border: 1px solid var(--btn-border);
            border-radius: var(--radius-md);
            padding: 10px 18px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #5d4037;
            cursor: pointer;
            text-align: center;
            min-width: 95px;
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: all 0.2s ease;
            line-height: 1.3;
        }

        .mhm-btn:hover {
            background: linear-gradient(180deg,
                    #ffffff 0%,
                    #ffe0b2 100%);
            transform: translateY(-1px);
            box-shadow:
                0 4px 8px rgba(0, 0, 0, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .mhm-btn:active {
            transform: translateY(0);
            box-shadow:
                0 1px 2px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .mhm-btn--exit {
            background: linear-gradient(180deg, #ffcdd2 0%, #ef9a9a 100%);
            border-color: #e57373;
            color: #b71c1c;
        }

        .mhm-btn--exit:hover {
            background: linear-gradient(180deg, #ffebee 0%, #ffcdd2 100%);
        }

        /* =============================================
   INFO STRIP
   ============================================= */
        .mhm-info-strip {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-md);
            padding: 12px 20px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-left: 4px solid var(--accent-orange);
        }

        .mhm-info-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .mhm-info-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .mhm-info-pet {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-orange-dark);
        }

        .mhm-info-date {
            font-size: 0.85rem;
            color: #666;
        }

        .mhm-info-disclaimer {
            font-size: 0.8rem;
            color: #555;
            max-width: 400px;
            text-align: right;
            font-style: italic;
        }

        /* =============================================
   NAVIGATION TABS
   ============================================= */
        .mhm-nav-tabs {
            display: flex;
            gap: 3px;
            overflow-x: auto;
            padding-bottom: 0;
            margin-bottom: 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        .mhm-nav-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .mhm-nav-tabs::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        .mhm-nav-tabs::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 2px;
        }

        .mhm-tab {
            background: linear-gradient(180deg, #c8e6c9 0%, #a5d6a7 100%);
            border: 1px solid var(--tab-border);
            border-bottom: none;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            padding: 10px 16px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary-green-dark);
            cursor: pointer;
            text-align: center;
            min-width: 90px;
            white-space: nowrap;
            transition: all 0.2s ease;
            flex-shrink: 0;
            line-height: 1.3;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
        }

        .mhm-tab:hover {
            background: linear-gradient(180deg, #e8f5e9 0%, #c8e6c9 100%);
        }

        .mhm-tab.active {
            background: linear-gradient(180deg, #ffffff 0%, #e8f5e9 100%);
            color: var(--primary-green-dark);
            border-bottom: 2px solid white;
            transform: translateY(2px);
            z-index: 10;
            position: relative;
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.1);
            font-weight: 700;
        }

        /* =============================================
   CONTENT PANEL
   ============================================= */
        .mhm-content-panel {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            padding: 20px;
            min-height: 500px;
            box-shadow: var(--shadow-medium);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-top: 2px solid rgba(255, 255, 255, 0.6);
            position: relative;
        }

        /* Tab Content */
        .mhm-tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .mhm-tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* =============================================
   FORM ELEMENTS
   ============================================= */

        /* Section Title */
        .mhm-section-title {
            color: var(--primary-green-dark);
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            margin: 0 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-green);
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mhm-section-title--alt {
            color: var(--accent-brown);
            border-bottom-color: var(--accent-brown);
        }

        .mhm-section-title--orange {
            color: var(--accent-orange-dark);
            border-bottom-color: var(--accent-orange);
        }

        /* Form Row */
        .mhm-form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        /* Form Group */
        .mhm-form-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 120px;
        }

        .mhm-form-group--small {
            flex: 0 0 80px;
            min-width: 60px;
        }

        .mhm-form-group--medium {
            flex: 1.5;
        }

        .mhm-form-group--large {
            flex: 2;
        }

        .mhm-form-group--xlarge {
            flex: 3;
        }

        /* Label */
        .mhm-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-label);
            margin-bottom: 4px;
            text-transform: none;
        }

        /* Input */
        .mhm-input {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 15px;
            padding: 8px 14px;
            font-size: 0.9rem;
            color: var(--text-body);
            box-shadow: inset 0 1px 3px var(--input-shadow);
            transition: all 0.2s ease;
            width: 100%;
        }

        .mhm-input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow:
                inset 0 1px 3px var(--input-shadow),
                0 0 0 3px rgba(56, 142, 60, 0.15);
        }

        .mhm-input::placeholder {
            color: #999;
            font-style: italic;
        }

        .mhm-input--readonly {
            background: #f5f5f5;
            color: #666;
        }

        .mhm-input--center {
            text-align: center;
        }

        /* Select */
        .mhm-select {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 15px;
            padding: 8px 14px;
            font-size: 0.9rem;
            color: var(--text-body);
            cursor: pointer;
            width: 100%;
        }

        /* Textarea */
        .mhm-textarea {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: var(--radius-md);
            padding: 10px 14px;
            font-size: 0.9rem;
            color: var(--text-body);
            box-shadow: inset 0 1px 3px var(--input-shadow);
            resize: vertical;
            min-height: 80px;
            width: 100%;
            font-family: inherit;
        }

        /* Radio & Checkbox Group */
        .mhm-radio-group {
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 0.8rem;
            flex-wrap: wrap;
        }

        .mhm-radio-group label {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            color: var(--text-body);
        }

        .mhm-radio-group input[type="radio"],
        .mhm-radio-group input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--primary-green);
        }

        .mhm-radio-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-right: 8px;
        }

        /* Checkbox grande */
        .mhm-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary-green);
        }

        /* =============================================
   TABLES
   ============================================= */
        .mhm-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }

        .mhm-table th,
        .mhm-table td {
            padding: 10px 12px;
            border: 1px solid #a5d6a7;
            font-size: 0.85rem;
        }

        .mhm-table th {
            background: linear-gradient(180deg, #e8f5e9 0%, #c8e6c9 100%);
            color: var(--primary-green-dark);
            font-weight: 600;
            text-align: center;
            text-transform: uppercase;
            font-size: 0.75rem;
        }

        .mhm-table td {
            text-align: center;
            background: white;
        }

        .mhm-table td.text-left {
            text-align: left;
        }

        .mhm-table tbody tr:hover {
            background: #e8f5e9;
        }

        /* =============================================
   CARDS & BLOCKS
   ============================================= */
        .mhm-card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: var(--radius-md);
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: var(--shadow-light);
            border-left: 5px solid var(--primary-green);
            transition: all 0.2s ease;
        }

        .mhm-card:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-2px);
        }

        .mhm-card--warning {
            border-left-color: var(--accent-orange);
            background: rgba(255, 243, 224, 0.9);
        }

        .mhm-card--danger {
            border-left-color: #d32f2f;
            background: rgba(255, 235, 238, 0.9);
        }

        .mhm-card--success {
            border-left-color: var(--primary-green);
            background: rgba(232, 245, 233, 0.9);
        }

        .mhm-card--brown {
            border-left-color: var(--accent-brown);
            background: rgba(239, 235, 233, 0.9);
        }

        .mhm-card-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-green-dark);
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* =============================================
   PET SPECIFIC STYLES
   ============================================= */

        /* Species selector */
        .species-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .species-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 15px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .species-option:hover {
            border-color: var(--primary-green);
            background: #e8f5e9;
        }

        .species-option.active {
            border-color: var(--accent-orange);
            background: #fff3e0;
            box-shadow: 0 2px 8px rgba(255, 112, 67, 0.3);
        }

        .species-option i {
            font-size: 2rem;
            color: var(--accent-brown);
        }

        .species-option span {
            font-size: 0.85rem;
            font-weight: 600;
            color: #333;
        }

        /* Pet photo section */
        .pet-photo-container {
            width: 150px;
            height: 150px;
            border: 3px dashed #a5d6a7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.2s;
        }

        .pet-photo-container:hover {
            border-color: var(--primary-green);
            background: #e8f5e9;
        }

        .pet-photo-container i {
            font-size: 3rem;
            color: #bdbdbd;
        }

        /* Vaccine card for pets */
        .vaccine-card {
            background: white;
            border: 1px solid #a5d6a7;
            border-radius: var(--radius-md);
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s;
        }

        .vaccine-card:hover {
            box-shadow: var(--shadow-light);
            border-color: var(--primary-green);
        }

        .vaccine-card.applied {
            background: #e8f5e9;
            border-color: var(--primary-green);
        }

        .vaccine-card i {
            font-size: 1.5rem;
            color: var(--primary-green);
        }

        .vaccine-card.pending i {
            color: #bdbdbd;
        }

        /* =============================================
   GRID LAYOUTS
   ============================================= */
        .mhm-grid {
            display: grid;
            gap: 15px;
        }

        .mhm-grid--2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .mhm-grid--3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .mhm-grid--4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .mhm-grid--auto {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* =============================================
   DIVIDERS
   ============================================= */
        .mhm-divider {
            border: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #a5d6a7, transparent);
            margin: 20px 0;
        }

        .mhm-divider--thick {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-green-light), transparent);
        }

        /* =============================================
   MODAL
   ============================================= */
        .mhm-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .mhm-modal {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-heavy);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .mhm-modal-header {
            background: linear-gradient(180deg, var(--primary-green) 0%, var(--primary-green-dark) 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mhm-modal-title {
            font-size: 1.1rem;
            font-weight: 700;
            text-transform: uppercase;
            margin: 0;
        }

        .mhm-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .mhm-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .mhm-modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* =============================================
   UTILITIES
   ============================================= */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-bold {
            font-weight: 700;
        }

        .text-danger {
            color: #d32f2f;
        }

        .text-success {
            color: var(--primary-green);
        }

        .text-warning {
            color: var(--accent-orange);
        }

        .mb-0 {
            margin-bottom: 0;
        }

        .mb-1 {
            margin-bottom: 8px;
        }

        .mb-2 {
            margin-bottom: 16px;
        }

        .mb-3 {
            margin-bottom: 24px;
        }

        .mt-0 {
            margin-top: 0;
        }

        .mt-1 {
            margin-top: 8px;
        }

        .mt-2 {
            margin-top: 16px;
        }

        .mt-3 {
            margin-top: 24px;
        }

        /* =============================================
   RESPONSIVE
   ============================================= */
        @media (max-width: 992px) {

            .mhm-grid--2,
            .mhm-grid--3,
            .mhm-grid--4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .mhm-header {
                flex-direction: column;
                text-align: center;
            }

            .mhm-header-buttons {
                justify-content: center;
            }

            .mhm-info-strip {
                flex-direction: column;
                text-align: center;
            }

            .mhm-info-disclaimer {
                text-align: center;
                max-width: 100%;
            }

            .mhm-form-row {
                flex-direction: column;
            }

            .mhm-form-group,
            .mhm-form-group--small,
            .mhm-form-group--medium,
            .mhm-form-group--large,
            .mhm-form-group--xlarge {
                flex: 1 1 100%;
            }

            .mhm-grid--2,
            .mhm-grid--3,
            .mhm-grid--4 {
                grid-template-columns: 1fr;
            }

            .mhm-nav-tabs {
                gap: 2px;
            }

            .mhm-tab {
                min-width: 80px;
                padding: 8px 10px;
                font-size: 0.7rem;
            }

            .mhm-btn {
                min-width: 80px;
                padding: 8px 12px;
                font-size: 0.7rem;
            }

            .mhm-logo-title {
                font-size: 2rem;
            }

            .species-selector {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .mhm-container {
                padding: 10px;
            }

            .mhm-content-panel {
                padding: 15px;
            }

            .mhm-tab {
                min-width: 70px;
                font-size: 0.65rem;
            }
        }

        /* =============================================
   PRINT STYLES
   ============================================= */
        @media print {
            body {
                background: white;
            }

            body::before {
                display: none;
            }

            .mhm-header-buttons,
            .mhm-nav-tabs {
                display: none;
            }

            .mhm-content-panel {
                background: white;
                box-shadow: none;
                border: 1px solid #ccc;
            }

            .mhm-card {
                break-inside: avoid;
            }
        }

        /* =============================================
   MULTI-PET SELECTOR & LANGUAGE TOGGLE
   ============================================= */

        /* Header Controls Container */
        .mhm-header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Pet Selector */
        .pet-selector-container {
            position: relative;
        }

        .pet-selector-btn {
            background: linear-gradient(180deg, #ffffff 0%, #e8f5e9 100%);
            border: 2px solid var(--primary-green);
            border-radius: var(--radius-lg);
            padding: 10px 16px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-green-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 180px;
            box-shadow: var(--shadow-light);
            transition: all 0.2s ease;
        }

        .pet-selector-btn:hover {
            background: linear-gradient(180deg, #ffffff 0%, #c8e6c9 100%);
            box-shadow: var(--shadow-medium);
            transform: translateY(-1px);
        }

        .pet-selector-btn i.fa-paw {
            color: var(--accent-orange);
            font-size: 1.1rem;
        }

        .pet-selector-btn i.fa-chevron-down {
            margin-left: auto;
            font-size: 0.8rem;
            transition: transform 0.2s ease;
        }

        .pet-selector-btn.open i.fa-chevron-down {
            transform: rotate(180deg);
        }

        /* Pet Selector Dropdown */
        .pet-selector-dropdown {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            background: white;
            border: 2px solid var(--primary-green);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-heavy);
            min-width: 250px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            animation: dropdownSlideIn 0.2s ease;
        }

        @keyframes dropdownSlideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pet-selector-dropdown.hidden {
            display: none;
        }

        .pet-list {
            padding: 8px;
        }

        .pet-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .pet-item:hover {
            background: #e8f5e9;
            border-color: var(--primary-green-light);
        }

        .pet-item.active {
            background: #c8e6c9;
            border-color: var(--primary-green);
            font-weight: 700;
        }

        .pet-item-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-orange-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .pet-item-info {
            flex: 1;
            min-width: 0;
        }

        .pet-item-name {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--primary-green-dark);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .pet-item-species {
            font-size: 0.75rem;
            color: #666;
        }

        .pet-item-delete {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 4px;
            font-size: 1rem;
            transition: color 0.2s ease;
            flex-shrink: 0;
        }

        .pet-item-delete:hover {
            color: #d32f2f;
        }

        /* Add Pet Button */
        .pet-add-btn {
            width: 100%;
            background: linear-gradient(180deg, #fff3e0 0%, #ffe0b2 100%);
            border: none;
            border-top: 1px solid #e0e0e0;
            padding: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-orange-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .pet-add-btn:hover {
            background: linear-gradient(180deg, #ffffff 0%, #fff3e0 100%);
        }

        .pet-add-btn i {
            font-size: 1.1rem;
        }

        /* Language Toggle */
        .language-toggle {
            display: flex;
            gap: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-lg);
            padding: 3px;
            box-shadow: var(--shadow-light);
        }

        .lang-btn {
            background: transparent;
            border: none;
            padding: 8px 16px;
            font-size: 0.85rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all 0.2s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .lang-btn.active {
            background: linear-gradient(180deg, #ffffff 0%, #e8f5e9 100%);
            color: var(--primary-green-dark);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            text-shadow: none;
        }
    </style>

    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="mhm-container">

        <!-- ==================== HEADER ==================== -->
        <header class="mhm-header">
            <!-- Logo -->
            <div class="mhm-logo">
                <div class="mhm-logo-icon">
                    <i class="fas fa-paw mhm-logo-paw"></i>
                </div>
                <div class="mhm-logo-text">
                    <h1 class="mhm-logo-title">MHM</h1>
                    <p class="mhm-logo-subtitle" data-i18n="appSubtitle">Mi Historia Médica - Mascota</p>
                </div>
            </div>

            <!-- Multi-Pet Selector & Language Toggle -->
            <div class="mhm-header-controls">
                <!-- Pet Selector -->
                <div class="pet-selector-container">
                    <button class="pet-selector-btn" id="pet-selector-btn">
                        <i class="fas fa-paw"></i>
                        <span id="current-pet-name">Max</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="pet-selector-dropdown hidden" id="pet-selector-dropdown">
                        <div class="pet-list" id="pet-list">
                            <!-- Populated by JS -->
                        </div>
                        <button class="pet-add-btn" id="pet-add-btn" data-i18n="addNewPet">
                            <i class="fas fa-plus-circle"></i> + Add New Pet
                        </button>
                    </div>
                </div>

                <!-- Language Toggle -->
                <div class="language-toggle">
                    <button class="lang-btn active" data-lang="es">ES</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mhm-header-buttons">
                <button class="mhm-btn" id="btn-summary">
                    <i class="fas fa-file-medical"></i><br><span data-i18n="summary">Resumen</span>
                </button>
                <button class="mhm-btn" id="btn-print">
                    <i class="fas fa-print"></i><br><span data-i18n="print">Imprimir</span>
                </button>
                <button class="mhm-btn" id="btn-backup">
                    <i class="fas fa-cloud-upload-alt"></i><br><span data-i18n="backup">Respaldo</span>
                </button>
                <button class="mhm-btn" id="btn-help">
                    <i class="fas fa-question-circle"></i><br><span data-i18n="help">Ayuda</span>
                </button>
                <button class="mhm-btn" id="btn-save">
                    <i class="fas fa-save"></i><br><span data-i18n="save">Guardar</span>
                </button>
                <button class="mhm-btn mhm-btn--exit" id="btn-exit">
                    <i class="fas fa-sign-out-alt"></i><br><span data-i18n="exit">Salir</span>
                </button>
            </div>
        </header>

        <!-- ==================== INFO STRIP ==================== -->
        <div class="mhm-info-strip">
            <div class="mhm-info-left">
                <div class="mhm-info-pet" id="info-pet-name">
                    <i class="fas fa-paw"></i> <span data-i18n="pet">Mascota</span>: <span
                        id="info-pet-display">Cargando...</span>
                </div>
                <div class="mhm-info-name" id="info-owner"><span data-i18n="owner">Propietario</span>: —</div>
                <div class="mhm-info-date" id="info-date"><span data-i18n="lastUpdate">Última actualización</span>: —
                </div>
            </div>
            <div class="mhm-info-disclaimer" data-i18n="infoDisclaimer">
                Información elaborada para uso veterinario y del propietario de la mascota.
            </div>
        </div>

        <!-- ==================== NAVIGATION TABS ==================== -->
        <nav class="mhm-nav-tabs" id="nav-tabs">
            <div class="mhm-tab active" data-tab="pet-info">
                <i class="fas fa-id-card"></i><br><span data-i18n="tabPetInfo">Datos de<br>la Mascota</span>
            </div>
            <div class="mhm-tab" data-tab="owner">
                <i class="fas fa-user"></i><br><span data-i18n="tabOwner">Datos del<br>Propietario</span>
            </div>
            <div class="mhm-tab" data-tab="pathologies">
                <i class="fas fa-notes-medical"></i><br><span
                    data-i18n="tabPathologies">Antecedentes<br>Patológicos</span>
            </div>
            <div class="mhm-tab" data-tab="meds">
                <i class="fas fa-pills"></i><br><span data-i18n="tabMedications">Medicamentos</span>
            </div>
            <div class="mhm-tab" data-tab="surgeries">
                <i class="fas fa-procedures"></i><br><span data-i18n="tabSurgeries">Cirugías<br>Hospitalizaciones</span>
            </div>
            <div class="mhm-tab" data-tab="allergies">
                <i class="fas fa-allergies"></i><br><span data-i18n="tabAllergies">Alergias</span>
            </div>
            <div class="mhm-tab" data-tab="vaccines">
                <i class="fas fa-syringe"></i><br><span data-i18n="tabVaccines">Vacunas<br>Desparasitación</span>
            </div>
            <div class="mhm-tab" data-tab="vets">
                <i class="fas fa-user-md"></i><br><span data-i18n="tabVets">Veterinarios</span>
            </div>
            <div class="mhm-tab" data-tab="labs">
                <i class="fas fa-flask"></i><br><span data-i18n="tabLabs">Exámenes<br>Laboratorio</span>
            </div>
            <div class="mhm-tab" data-tab="nutrition">
                <i class="fas fa-bone"></i><br><span data-i18n="tabNutrition">Nutrición<br>Dieta</span>
            </div>
        </nav>

        <!-- ==================== CONTENT PANEL ==================== -->
        <main class="mhm-content-panel">

            <!-- ========== TAB: DATOS DE LA MASCOTA ========== -->
            <div id="tab-pet-info" class="mhm-tab-content active">
                <h2 class="mhm-section-title">
                    <i class="fas fa-paw"></i> <span data-i18n="petInfo">Información de la Mascota</span>
                </h2>

                <div class="mhm-form-row">
                    <!-- Pet Photo -->
                    <div class="mhm-form-group" style="flex: 0 0 180px; align-items: center;">
                        <div class="pet-photo-container" id="pet-photo" title="Click para cambiar foto">
                            <i class="fas fa-camera"></i>
                            <img id="pet-photo-preview"
                                style="display: none; width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"
                                alt="Foto de mascota">
                        </div>
                        <input type="file" id="pet-photo-input" accept="image/*" style="display: none;">
                        <button class="mhm-btn" id="pet-photo-btn" style="margin-top: 10px; min-width: 120px;">
                            <i class="fas fa-upload"></i> <span data-i18n="uploadPhoto">Subir Foto</span>
                        </button>
                    </div>

                    <!-- Pet Basic Info -->
                    <div class="mhm-form-group mhm-form-group--xlarge">
                        <div class="mhm-form-row">
                            <div class="mhm-form-group mhm-form-group--large">
                                <label class="mhm-label" data-i18n="petName">Nombre de la Mascota</label>
                                <input type="text" class="mhm-input" id="pet-name"
                                    style="font-size: 1.2rem; font-weight: 700;">
                            </div>
                            <div class="mhm-form-group">
                                <label class="mhm-label" data-i18n="microchip">Microchip / ID</label>
                                <input type="text" class="mhm-input" id="pet-microchip">
                            </div>
                        </div>

                        <!-- Species Selection -->
                        <label class="mhm-label" data-i18n="species">Especie</label>
                        <div class="species-selector" id="species-selector">
                            <div class="species-option active" data-species="perro">
                                <i class="fas fa-dog"></i>
                                <span data-i18n="dog">Perro</span>
                            </div>
                            <div class="species-option" data-species="gato">
                                <i class="fas fa-cat"></i>
                                <span data-i18n="cat">Gato</span>
                            </div>
                            <div class="species-option" data-species="ave">
                                <i class="fas fa-dove"></i>
                                <span data-i18n="bird">Ave</span>
                            </div>
                            <div class="species-option" data-species="conejo">
                                <i class="fas fa-rabbit"></i>
                                <span data-i18n="rabbit">Conejo</span>
                            </div>
                            <div class="species-option" data-species="hamster">
                                <i class="fas fa-paw"></i>
                                <span data-i18n="hamster">Hamster</span>
                            </div>
                            <div class="species-option" data-species="otro">
                                <i class="fas fa-question"></i>
                                <span data-i18n="other">Otro</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 2: Breed, Color, etc -->
                <div class="mhm-form-row">
                    <div class="mhm-form-group mhm-form-group--large">
                        <label class="mhm-label" data-i18n="breed">Raza</label>
                        <input type="text" class="mhm-input" id="pet-breed">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="color">Color / Pelaje</label>
                        <input type="text" class="mhm-input" id="pet-color">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="dateOfBirth">Fecha de Nacimiento</label>
                        <input type="date" class="mhm-input" id="pet-dob">
                    </div>
                    <div class="mhm-form-group mhm-form-group--small">
                        <label class="mhm-label" data-i18n="age">Edad</label>
                        <input type="text" class="mhm-input mhm-input--center mhm-input--readonly" id="pet-age"
                            readonly>
                    </div>
                </div>

                <!-- Row 3: Sex, Weight, Height -->
                <div class="mhm-form-row">
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="gender">Sexo</label>
                        <div class="mhm-radio-group">
                            <label><input type="radio" name="pet-sex" value="macho"> <span
                                    data-i18n="male">Macho</span></label>
                            <label><input type="radio" name="pet-sex" value="hembra"> <span
                                    data-i18n="female">Hembra</span></label>
                        </div>
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="sterilized">Esterilizado/Castrado</label>
                        <div class="mhm-radio-group">
                            <label><input type="radio" name="pet-sterilized" value="si"> <span
                                    data-i18n="yes">Sí</span></label>
                            <label><input type="radio" name="pet-sterilized" value="no"> <span
                                    data-i18n="no">No</span></label>
                        </div>
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="weight">Peso (kg)</label>
                        <input type="text" class="mhm-input mhm-input--center" id="pet-weight">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="size">Tamaño</label>
                        <select class="mhm-select" id="pet-size">
                            <option value="" data-i18n="sizeSelect">Seleccione...</option>
                            <option value="mini" data-i18n="sizeMini">Mini (hasta 4 kg)</option>
                            <option value="pequeno" data-i18n="sizeSmall">Pequeño (4-10 kg)</option>
                            <option value="mediano" data-i18n="sizeMedium">Mediano (10-25 kg)</option>
                            <option value="grande" data-i18n="sizeLarge">Grande (25-45 kg)</option>
                            <option value="gigante" data-i18n="sizeGiant">Gigante (más de 45 kg)</option>
                        </select>
                    </div>
                </div>

                <!-- Row 4: Temperament & Behavior -->
                <hr class="mhm-divider">

                <h3 class="mhm-section-title mhm-section-title--alt">
                    <i class="fas fa-heart"></i> <span data-i18n="temperamentBehavior">Temperamento y
                        Comportamiento</span>
                </h3>

                <div class="mhm-form-row">
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="temperament">Temperamento General</label>
                        <select class="mhm-select" id="pet-temperament">
                            <option value="" data-i18n="temperamentSelect">Seleccione...</option>
                            <option value="tranquilo" data-i18n="temperamentCalm">Tranquilo / Dócil</option>
                            <option value="activo" data-i18n="temperamentActive">Activo / Juguetón</option>
                            <option value="nervioso" data-i18n="temperamentNervous">Nervioso / Ansioso</option>
                            <option value="agresivo" data-i18n="temperamentAggressive">Agresivo / Territorial</option>
                            <option value="timido" data-i18n="temperamentShy">Tímido / Miedoso</option>
                        </select>
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="activityLevel">Nivel de Actividad</label>
                        <select class="mhm-select" id="pet-activity">
                            <option value="" data-i18n="temperamentSelect">Seleccione...</option>
                            <option value="bajo" data-i18n="activityLow">Bajo (sedentario)</option>
                            <option value="moderado" data-i18n="activityModerate">Moderado</option>
                            <option value="alto" data-i18n="activityHigh">Alto (muy activo)</option>
                        </select>
                    </div>
                    <div class="mhm-form-group mhm-form-group--large">
                        <label class="mhm-label" data-i18n="socialWithPets">¿Se relaciona bien con otras
                            mascotas?</label>
                        <div class="mhm-radio-group">
                            <label><input type="radio" name="pet-social" value="si"> <span
                                    data-i18n="yes">Sí</span></label>
                            <label><input type="radio" name="pet-social" value="no"> <span
                                    data-i18n="no">No</span></label>
                            <label><input type="radio" name="pet-social" value="algunos"> <span
                                    data-i18n="someOnly">Solo con algunos</span></label>
                        </div>
                    </div>
                </div>

                <div class="mhm-form-row">
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="behaviorNotes">Observaciones de Comportamiento</label>
                        <textarea class="mhm-textarea" id="pet-behavior-notes"
                            data-i18n-placeholder="behaviorPlaceholder"></textarea>
                    </div>
                </div>
            </div>

            <!-- ========== TAB: DATOS DEL PROPIETARIO ========== -->
            <div id="tab-owner" class="mhm-tab-content">
                <h2 class="mhm-section-title">
                    <i class="fas fa-user"></i> <span data-i18n="ownerData">Datos del Propietario</span>
                </h2>

                <div class="mhm-form-row">
                    <div class="mhm-form-group mhm-form-group--large">
                        <label class="mhm-label" data-i18n="fullName">Nombre Completo</label>
                        <input type="text" class="mhm-input" id="owner-name">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="documentType">Tipo de Documento</label>
                        <select class="mhm-select" id="owner-id-type">
                            <option value="CC" data-i18n="citizenId">Cédula de Ciudadanía</option>
                            <option value="CE" data-i18n="foreignId">Cédula de Extranjería</option>
                            <option value="PA" data-i18n="passport">Pasaporte</option>
                        </select>
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="documentNumber">Número de Documento</label>
                        <input type="text" class="mhm-input" id="owner-id">
                    </div>
                </div>

                <div class="mhm-form-row">
                    <div class="mhm-form-group mhm-form-group--xlarge">
                        <label class="mhm-label" data-i18n="address">Dirección</label>
                        <input type="text" class="mhm-input" id="owner-address">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="city">Ciudad</label>
                        <input type="text" class="mhm-input" id="owner-city">
                    </div>
                </div>

                <div class="mhm-form-row">
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="cellPhone">Teléfono Celular</label>
                        <input type="tel" class="mhm-input" id="owner-cell">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="phone">Teléfono Fijo</label>
                        <input type="tel" class="mhm-input" id="owner-phone">
                    </div>
                    <div class="mhm-form-group mhm-form-group--large">
                        <label class="mhm-label" data-i18n="email">Correo Electrónico</label>
                        <input type="email" class="mhm-input" id="owner-email">
                    </div>
                </div>

                <hr class="mhm-divider">

                <!-- Secondary Contact -->
                <h3 class="mhm-section-title">
                    <i class="fas fa-user-friends"></i> <span data-i18n="emergencyContact">Contacto de Emergencia /
                        Cuidador Secundario</span>
                </h3>

                <div class="mhm-form-row">
                    <div class="mhm-form-group mhm-form-group--large">
                        <label class="mhm-label" data-i18n="fullName">Nombre Completo</label>
                        <input type="text" class="mhm-input" id="contact-name">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="emergencyRelation">Relación con el Propietario</label>
                        <input type="text" class="mhm-input" id="contact-relation">
                    </div>
                </div>

                <div class="mhm-form-row">
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="cellPhone">Teléfono Celular</label>
                        <input type="tel" class="mhm-input" id="contact-cell">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="phone">Teléfono Fijo</label>
                        <input type="tel" class="mhm-input" id="contact-phone">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="authorizedDecisions">¿Autorizado para tomar decisiones
                            médicas?</label>
                        <div class="mhm-radio-group">
                            <label><input type="radio" name="contact-auth" value="si"> <span
                                    data-i18n="yes">Sí</span></label>
                            <label><input type="radio" name="contact-auth" value="no"> <span
                                    data-i18n="no">No</span></label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== TAB: ANTECEDENTES PATOLÓGICOS ========== -->
            <div id="tab-pathologies" class="mhm-tab-content">
                <h2 class="mhm-section-title">
                    <i class="fas fa-notes-medical"></i> <span data-i18n="pathologies">Antecedentes Patológicos</span>
                </h2>

                <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;" data-i18n="pathologiesDesc">
                    Marque las condiciones que la mascota ha presentado o presenta actualmente:
                </p>

                <div class="mhm-grid mhm-grid--2" id="pathologies-grid">
                    <!-- Column 1 -->
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-heartbeat"></i> <span
                                data-i18n="cardiovascular">Cardiovascular / Respiratorio</span></h3>
                        <div id="patho-cardio"></div>
                    </div>

                    <!-- Column 2 -->
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-bone"></i> <span
                                data-i18n="musculoskeletal">Musculoesquelético</span></h3>
                        <div id="patho-musculo"></div>
                    </div>

                    <!-- Column 3 -->
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-stomach"></i> <span
                                data-i18n="digestive">Digestivo</span></h3>
                        <div id="patho-digestive"></div>
                    </div>

                    <!-- Column 4 -->
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-allergies"></i> <span data-i18n="skin">Piel /
                                Dermatológico</span></h3>
                        <div id="patho-skin"></div>
                    </div>

                    <!-- Column 5 -->
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-eye"></i> <span data-i18n="sensory">Ojos /
                                Oídos</span></h3>
                        <div id="patho-sensory"></div>
                    </div>

                    <!-- Column 6 -->
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-brain"></i> <span
                                data-i18n="neurological">Neurológico / Comportamiento</span></h3>
                        <div id="patho-neuro"></div>
                    </div>
                </div>

                <div class="mhm-card mhm-card--warning mt-2">
                    <h3 class="mhm-card-title"><i class="fas fa-plus-circle"></i> <span
                            data-i18n="otherConditions">Otras Condiciones</span></h3>
                    <textarea class="mhm-textarea" id="patho-other"
                        data-i18n-placeholder="otherConditionsPlaceholder"></textarea>
                </div>
            </div>

            <!-- ========== TAB: MEDICAMENTOS ========== -->
            <div id="tab-meds" class="mhm-tab-content">
                <h2 class="mhm-section-title">
                    <i class="fas fa-pills"></i> <span data-i18n="currentMedications">Medicamentos Actuales</span>
                </h2>

                <table class="mhm-table" id="meds-table">
                    <thead>
                        <tr>
                            <th style="width: 10%" data-i18n="startDate">Fecha Inicio</th>
                            <th style="width: 25%" data-i18n="medication">Medicamento</th>
                            <th style="width: 15%" data-i18n="dose">Dosis</th>
                            <th style="width: 15%" data-i18n="frequency">Frecuencia</th>
                            <th style="width: 20%" data-i18n="reason">Motivo</th>
                            <th style="width: 8%" data-i18n="active">Activo</th>
                            <th style="width: 7%" data-i18n="finished">Terminado</th>
                        </tr>
                    </thead>
                    <tbody id="meds-tbody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>

                <hr class="mhm-divider mhm-divider--thick">

                <h2 class="mhm-section-title mhm-section-title--orange">
                    <i class="fas fa-shield-virus"></i> <span data-i18n="preventives">Antiparasitarios y
                        Preventivos</span>
                </h2>

                <div class="mhm-grid mhm-grid--3">
                    <div class="mhm-card">
                        <h4 class="mhm-card-title"><i class="fas fa-bug"></i> <span
                                data-i18n="fleaTick">Antipulgas/Garrapatas</span></h4>
                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="product">Producto Usado</label>
                            <input type="text" class="mhm-input" id="flea-product"
                                placeholder="Ej: Frontline, Nexgard...">
                        </div>
                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="lastApplication">Última Aplicación</label>
                            <input type="date" class="mhm-input" id="flea-date">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="nextApplication">Próxima Aplicación</label>
                            <input type="date" class="mhm-input" id="flea-next">
                        </div>
                    </div>

                    <div class="mhm-card">
                        <h4 class="mhm-card-title"><i class="fas fa-worm"></i> <span data-i18n="dewormer">Desparasitante
                                Interno</span></h4>
                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="product">Producto Usado</label>
                            <input type="text" class="mhm-input" id="dewormer-product"
                                placeholder="Ej: Drontal, Caniquantel...">
                        </div>
                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="lastApplication">Última Aplicación</label>
                            <input type="date" class="mhm-input" id="dewormer-date">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="nextApplication">Próxima Aplicación</label>
                            <input type="date" class="mhm-input" id="dewormer-next">
                        </div>
                    </div>

                    <div class="mhm-card">
                        <h4 class="mhm-card-title"><i class="fas fa-heart-pulse"></i> <span
                                data-i18n="heartworm">Prevención de Gusano del Corazón</span></h4>
                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="product">Producto Usado</label>
                            <input type="text" class="mhm-input" id="heartworm-product"
                                placeholder="Ej: Heartgard, Interceptor...">
                        </div>
                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="lastApplication">Última Aplicación</label>
                            <input type="date" class="mhm-input" id="heartworm-date">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="nextApplication">Próxima Aplicación</label>
                            <input type="date" class="mhm-input" id="heartworm-next">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== TAB: CIRUGÍAS ========== -->
            <div id="tab-surgeries" class="mhm-tab-content">
                <h2 class="mhm-section-title">
                    <i class="fas fa-procedures"></i> <span data-i18n="surgeriesHospitalizations">Registro de Cirugías y
                        Hospitalizaciones</span>
                </h2>

                <table class="mhm-table" id="surgeries-table">
                    <thead>
                        <tr>
                            <th style="width: 12%" data-i18n="date">Fecha</th>
                            <th style="width: 25%" data-i18n="procedure">Procedimiento</th>
                            <th style="width: 20%" data-i18n="clinic">Clínica/Hospital</th>
                            <th style="width: 20%" data-i18n="veterinarian">Veterinario</th>
                            <th style="width: 23%" data-i18n="observations">Observaciones</th>
                        </tr>
                    </thead>
                    <tbody id="surgeries-tbody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>

                <hr class="mhm-divider">

                <div class="mhm-card mhm-card--success">
                    <h3 class="mhm-card-title"><i class="fas fa-cut"></i> <span
                            data-i18n="sterilizationInfo">Esterilización / Castración</span></h3>
                    <div class="mhm-form-row">
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="sterilizedQuestion">¿Fue esterilizado/castrado?</label>
                            <div class="mhm-radio-group">
                                <label><input type="radio" name="sterilization" value="si"> <span
                                        data-i18n="yes">Sí</span></label>
                                <label><input type="radio" name="sterilization" value="no"> <span
                                        data-i18n="no">No</span></label>
                            </div>
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="sterilizationDate">Fecha del Procedimiento</label>
                            <input type="date" class="mhm-input" id="sterilization-date">
                        </div>
                        <div class="mhm-form-group mhm-form-group--large">
                            <label class="mhm-label" data-i18n="sterilizationClinic">Clínica que realizó el
                                procedimiento</label>
                            <input type="text" class="mhm-input" id="sterilization-clinic">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== TAB: ALERGIAS ========== -->
            <div id="tab-allergies" class="mhm-tab-content">
                <h2 class="mhm-section-title mhm-section-title--orange">
                    <i class="fas fa-exclamation-triangle"></i> <span data-i18n="allergies">Registro de Alergias</span>
                </h2>

                <!-- Common Allergies -->
                <div class="mhm-card mhm-card--danger">
                    <h3 class="mhm-card-title" data-i18n="foodAllergies">Alergias Alimentarias Comunes</h3>
                    <div class="mhm-radio-group" style="flex-wrap: wrap; gap: 20px;">
                        <label><input type="checkbox" id="allergy-chicken"> <span
                                data-i18n="chicken">Pollo</span></label>
                        <label><input type="checkbox" id="allergy-beef"> <span data-i18n="beef">Res</span></label>
                        <label><input type="checkbox" id="allergy-wheat"> <span
                                data-i18n="wheat">Trigo/Gluten</span></label>
                        <label><input type="checkbox" id="allergy-corn"> <span data-i18n="corn">Maíz</span></label>
                        <label><input type="checkbox" id="allergy-soy"> <span data-i18n="soy">Soya</span></label>
                        <label><input type="checkbox" id="allergy-dairy"> <span data-i18n="dairy">Lácteos</span></label>
                        <label><input type="checkbox" id="allergy-fish"> <span data-i18n="fish">Pescado</span></label>
                        <label><input type="checkbox" id="allergy-eggs"> <span data-i18n="eggs">Huevos</span></label>
                    </div>
                </div>

                <div class="mhm-grid mhm-grid--2 mt-2">
                    <!-- Medication Allergies -->
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-pills"></i> <span
                                data-i18n="medicationAllergies">Alergias a Medicamentos</span></h3>
                        <div id="med-allergies-container">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Environmental Allergies -->
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-leaf"></i> <span
                                data-i18n="environmentalAllergies">Alergias Ambientales</span></h3>
                        <div id="env-allergies-container">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <div class="mhm-card mhm-card--warning mt-2">
                    <h3 class="mhm-card-title"><i class="fas fa-notes-medical"></i> <span
                            data-i18n="allergicReactions">Reacciones Alérgicas Conocidas</span></h3>
                    <textarea class="mhm-textarea" id="allergy-reactions"
                        data-i18n-placeholder="allergicReactionsPlaceholder"></textarea>
                </div>
            </div>

            <!-- ========== TAB: VACUNAS ========== -->
            <div id="tab-vaccines" class="mhm-tab-content">
                <h2 class="mhm-section-title">
                    <i class="fas fa-syringe"></i> <span data-i18n="vaccines">Esquema de Vacunación</span>
                </h2>

                <!-- Dog Vaccines -->
                <div class="mhm-card" id="dog-vaccines">
                    <h3 class="mhm-card-title"><i class="fas fa-dog"></i> <span data-i18n="dogVaccines">Vacunas para
                            Perros</span></h3>
                    <table class="mhm-table">
                        <thead>
                            <tr>
                                <th data-i18n="vaccine">Vacuna</th>
                                <th data-i18n="dose1">Dosis 1</th>
                                <th data-i18n="dose2">Dosis 2</th>
                                <th data-i18n="dose3">Dosis 3</th>
                                <th data-i18n="annualBooster">Refuerzo Anual</th>
                                <th data-i18n="nextDate">Próxima Fecha</th>
                            </tr>
                        </thead>
                        <tbody id="dog-vaccines-tbody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Cat Vaccines -->
                <div class="mhm-card mt-2 hidden" id="cat-vaccines">
                    <h3 class="mhm-card-title"><i class="fas fa-cat"></i> <span data-i18n="catVaccines">Vacunas para
                            Gatos</span></h3>
                    <table class="mhm-table">
                        <thead>
                            <tr>
                                <th data-i18n="vaccine">Vacuna</th>
                                <th data-i18n="dose1">Dosis 1</th>
                                <th data-i18n="dose2">Dosis 2</th>
                                <th data-i18n="annualBooster">Refuerzo Anual</th>
                                <th data-i18n="nextDate">Próxima Fecha</th>
                            </tr>
                        </thead>
                        <tbody id="cat-vaccines-tbody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <hr class="mhm-divider mhm-divider--thick">

                <h2 class="mhm-section-title mhm-section-title--alt">
                    <i class="fas fa-calendar-check"></i> <span data-i18n="vaccineHistory">Historial de
                        Vacunación</span>
                </h2>

                <table class="mhm-table">
                    <thead>
                        <tr>
                            <th data-i18n="date">Fecha</th>
                            <th data-i18n="vaccineApplied">Vacuna Aplicada</th>
                            <th data-i18n="lot">Lote</th>
                            <th data-i18n="veterinarian">Veterinario</th>
                            <th data-i18n="clinic">Clínica</th>
                            <th data-i18n="nextAppointment">Próxima Cita</th>
                        </tr>
                    </thead>
                    <tbody id="vaccine-history-tbody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>

            <!-- ========== TAB: VETERINARIOS ========== -->
            <div id="tab-vets" class="mhm-tab-content">
                <h2 class="mhm-section-title">
                    <i class="fas fa-user-md"></i> <span data-i18n="mainVeterinarian">Veterinario Principal</span>
                </h2>

                <div class="mhm-card mhm-card--success">
                    <div class="mhm-form-row">
                        <div class="mhm-form-group mhm-form-group--large">
                            <label class="mhm-label" data-i18n="vetName">Nombre del Veterinario</label>
                            <input type="text" class="mhm-input" id="vet-main-name">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="specialty">Especialidad</label>
                            <input type="text" class="mhm-input" id="vet-main-specialty" value="Medicina General">
                        </div>
                    </div>
                    <div class="mhm-form-row">
                        <div class="mhm-form-group mhm-form-group--large">
                            <label class="mhm-label" data-i18n="vetClinic">Clínica Veterinaria</label>
                            <input type="text" class="mhm-input" id="vet-main-clinic">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="phone">Teléfono</label>
                            <input type="tel" class="mhm-input" id="vet-main-phone">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="cellPhone">Celular</label>
                            <input type="tel" class="mhm-input" id="vet-main-cell">
                        </div>
                    </div>
                    <div class="mhm-form-row">
                        <div class="mhm-form-group mhm-form-group--xlarge">
                            <label class="mhm-label" data-i18n="address">Dirección</label>
                            <input type="text" class="mhm-input" id="vet-main-address">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="hours">Horario de Atención</label>
                            <input type="text" class="mhm-input" id="vet-main-hours"
                                data-i18n-placeholder="hoursPlaceholder">
                        </div>
                    </div>
                </div>

                <hr class="mhm-divider">

                <h3 class="mhm-section-title">
                    <i class="fas fa-stethoscope"></i> <span data-i18n="specialists">Especialistas Consultados</span>
                </h3>

                <div id="specialists-container">
                    <!-- Populated by JS -->
                </div>

                <hr class="mhm-divider">

                <h3 class="mhm-section-title mhm-section-title--orange">
                    <i class="fas fa-ambulance"></i> <span data-i18n="emergencyClinic">Clínica de Emergencias 24
                        Horas</span>
                </h3>

                <div class="mhm-card mhm-card--warning">
                    <div class="mhm-form-row">
                        <div class="mhm-form-group mhm-form-group--large">
                            <label class="mhm-label" data-i18n="clinicName">Nombre de la Clínica</label>
                            <input type="text" class="mhm-input" id="emergency-clinic">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="emergencyPhone">Teléfono Emergencias</label>
                            <input type="tel" class="mhm-input" id="emergency-phone"
                                style="font-weight: 700; color: #d32f2f;">
                        </div>
                    </div>
                    <div class="mhm-form-row">
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="address">Dirección</label>
                            <input type="text" class="mhm-input" id="emergency-address">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== TAB: LABORATORIOS ========== -->
            <div id="tab-labs" class="mhm-tab-content">
                <h2 class="mhm-section-title">
                    <i class="fas fa-flask"></i> <span data-i18n="labResults">Exámenes de Laboratorio</span>
                </h2>

                <div class="mhm-card">
                    <h3 class="mhm-card-title" data-i18n="labHistory">Historial de Exámenes</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;" data-i18n="labHistoryDesc">
                        Registro de todos los exámenes de laboratorio realizados a la mascota.
                    </p>
                </div>

                <table class="mhm-table mt-2">
                    <thead>
                        <tr>
                            <th data-i18n="date">Fecha</th>
                            <th data-i18n="examType">Tipo de Examen</th>
                            <th data-i18n="laboratory">Laboratorio</th>
                            <th data-i18n="result">Resultado</th>
                            <th data-i18n="requestingVet">Veterinario Solicitante</th>
                            <th data-i18n="file">Archivo</th>
                        </tr>
                    </thead>
                    <tbody id="labs-tbody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>

                <button class="mhm-btn mt-2" id="btn-add-lab">
                    <i class="fas fa-plus"></i> <span data-i18n="addExam">Agregar Examen</span>
                </button>
            </div>

            <!-- ========== TAB: NUTRICIÓN ========== -->
            <div id="tab-nutrition" class="mhm-tab-content">
                <h2 class="mhm-section-title">
                    <i class="fas fa-bone"></i> <span data-i18n="nutrition">Nutrición y Alimentación</span>
                </h2>

                <div class="mhm-grid mhm-grid--2">
                    <div class="mhm-card">
                        <h3 class="mhm-card-title"><i class="fas fa-utensils"></i> <span
                                data-i18n="currentFood">Alimentación Actual</span></h3>

                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="foodType">Tipo de Alimentación</label>
                            <select class="mhm-select" id="food-type">
                                <option value="" data-i18n="foodTypeSelect">Seleccione...</option>
                                <option value="concentrado" data-i18n="foodDry">Concentrado/Croquetas</option>
                                <option value="humedo" data-i18n="foodWet">Alimento Húmedo</option>
                                <option value="barf" data-i18n="foodBarf">Dieta BARF (cruda)</option>
                                <option value="casera" data-i18n="foodHomemade">Comida Casera</option>
                                <option value="mixta" data-i18n="foodMixed">Mixta (varias)</option>
                            </select>
                        </div>

                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="foodBrand">Marca/Producto Principal</label>
                            <input type="text" class="mhm-input" id="food-brand"
                                data-i18n-placeholder="foodBrandPlaceholder">
                        </div>

                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="foodLine">Línea/Variedad</label>
                            <input type="text" class="mhm-input" id="food-line"
                                data-i18n-placeholder="foodLinePlaceholder">
                        </div>

                        <div class="mhm-form-row">
                            <div class="mhm-form-group">
                                <label class="mhm-label" data-i18n="dailyAmount">Cantidad Diaria (gramos)</label>
                                <input type="text" class="mhm-input mhm-input--center" id="food-quantity">
                            </div>
                            <div class="mhm-form-group">
                                <label class="mhm-label" data-i18n="feedingTimes">Veces al Día</label>
                                <select class="mhm-select" id="food-frequency">
                                    <option value="1">1</option>
                                    <option value="2" selected>2</option>
                                    <option value="3">3</option>
                                    <option value="libre">Libre</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mhm-card mhm-card--brown">
                        <h3 class="mhm-card-title"><i class="fas fa-cookie-bite"></i> <span
                                data-i18n="treatsSnacks">Snacks y Premios</span></h3>

                        <div class="mhm-form-group mb-1">
                            <label class="mhm-label" data-i18n="givesTreats">¿Recibe snacks/premios?</label>
                            <div class="mhm-radio-group">
                                <label><input type="radio" name="gives-snacks" value="si"> <span
                                        data-i18n="yes">Sí</span></label>
                                <label><input type="radio" name="gives-snacks" value="no"> <span
                                        data-i18n="no">No</span></label>
                                <label><input type="radio" name="gives-snacks" value="ocasional"> <span
                                        data-i18n="occasionally">Ocasionalmente</span></label>
                            </div>
                        </div>

                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="treatTypes">Tipos de Snacks</label>
                            <textarea class="mhm-textarea" id="snack-types"
                                data-i18n-placeholder="treatTypesPlaceholder"></textarea>
                        </div>
                    </div>
                </div>

                <hr class="mhm-divider">

                <div class="mhm-card mhm-card--warning">
                    <h3 class="mhm-card-title"><i class="fas fa-weight"></i> <span data-i18n="weightControl">Control de
                            Peso</span></h3>

                    <div class="mhm-form-row">
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="currentWeight">Peso Actual (kg)</label>
                            <input type="text" class="mhm-input mhm-input--center" id="current-weight"
                                style="font-size: 1.3rem; font-weight: 700;">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="idealWeight">Peso Ideal (según veterinario)</label>
                            <input type="text" class="mhm-input mhm-input--center" id="ideal-weight">
                        </div>
                        <div class="mhm-form-group">
                            <label class="mhm-label" data-i18n="bodyCondition">Condición Corporal</label>
                            <select class="mhm-select" id="body-condition">
                                <option value="" data-i18n="temperamentSelect">Seleccione...</option>
                                <option value="1" data-i18n="bodyCondition1">1 - Muy delgado (caquéctico)</option>
                                <option value="2" data-i18n="bodyCondition2">2 - Bajo peso</option>
                                <option value="3" data-i18n="bodyCondition3">3 - Peso ideal</option>
                                <option value="4" data-i18n="bodyCondition4">4 - Sobrepeso</option>
                                <option value="5" data-i18n="bodyCondition5">5 - Obeso</option>
                            </select>
                        </div>
                    </div>

                    <div class="mhm-form-group mt-2">
                        <label class="mhm-label" data-i18n="weightHistory">Historial de Peso</label>
                        <table class="mhm-table">
                            <thead>
                                <tr>
                                    <th data-i18n="date">Fecha</th>
                                    <th data-i18n="weight">Peso (kg)</th>
                                    <th data-i18n="observations">Observaciones</th>
                                </tr>
                            </thead>
                            <tbody id="weight-history-tbody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mhm-card mt-2">
                    <h3 class="mhm-card-title"><i class="fas fa-info-circle"></i> <span
                            data-i18n="nutritionNotes">Observaciones Nutricionales</span></h3>
                    <textarea class="mhm-textarea" id="nutrition-notes"
                        data-i18n-placeholder="nutritionNotesPlaceholder"></textarea>
                </div>
            </div>

        </main>

    </div>

    <!-- ==================== MODAL: SUMMARY ==================== -->
    <div id="summary-modal" class="mhm-modal-overlay hidden">
        <div class="mhm-modal" style="max-width: 900px;">
            <div class="mhm-modal-header">
                <h3 class="mhm-modal-title">
                    <i class="fas fa-paw"></i> <span data-i18n="summaryTitle">Resumen de Historia Médica
                        Veterinaria</span>
                </h3>
                <button class="mhm-modal-close" id="summary-close">&times;</button>
            </div>
            <div class="mhm-modal-body" id="summary-body" style="max-height: 70vh;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- ==================== SCRIPTS ==================== -->
    <script>
        // ============================================
        // TRANSLATIONS - MHM MASCOTA MULTI
        // Bilingual Support: Spanish (ES) / English (EN)
        // ============================================

        const TRANSLATIONS = {
            es: {
                // Header & Actions
                appTitle: "MHM - Mi Historia Médica - Mascota",
                appSubtitle: "Mi Historia Médica - Mascota",
                summary: "Resumen",
                save: "Guardar",
                backup: "Respaldo",
                print: "Imprimir",
                exit: "Salir",
                help: "Ayuda",

                // Info Strip
                pet: "Mascota",
                owner: "Propietario",
                lastUpdate: "Última actualización",
                infoDisclaimer: "Información elaborada para uso veterinario y del propietario de la mascota.",

                // Navigation Tabs
                tabPetInfo: "Datos de la Mascota",
                tabOwner: "Datos del Propietario",
                tabPathologies: "Antecedentes Patológicos",
                tabMedications: "Medicamentos",
                tabSurgeries: "Cirugías / Hospitalizaciones",
                tabAllergies: "Alergias",
                tabVaccines: "Vacunas / Desparasitación",
                tabVets: "Veterinarios",
                tabLabs: "Exámenes de Laboratorio",
                tabNutrition: "Nutrición / Dieta",

                // Pet Info Section
                petInfo: "Información de la Mascota",
                petPhoto: "Foto de la Mascota",
                uploadPhoto: "Subir Foto",
                petName: "Nombre de la Mascota",
                microchip: "Microchip / ID",
                species: "Especie",
                dog: "Perro",
                cat: "Gato",
                bird: "Ave",
                rabbit: "Conejo",
                hamster: "Hámster",
                other: "Otro",
                breed: "Raza",
                color: "Color / Pelaje",
                dateOfBirth: "Fecha de Nacimiento",
                age: "Edad",
                gender: "Sexo",
                male: "Macho",
                female: "Hembra",
                weight: "Peso (kg)",
                size: "Tamaño",
                sizeSelect: "Seleccione...",
                sizeMini: "Mini (hasta 4 kg)",
                sizeSmall: "Pequeño (4-10 kg)",
                sizeMedium: "Mediano (10-25 kg)",
                sizeLarge: "Grande (25-45 kg)",
                sizeGiant: "Gigante (más de 45 kg)",
                sterilized: "Esterilizado/Castrado",
                yes: "Sí",
                no: "No",
                temperamentBehavior: "Temperamento y Comportamiento",
                temperament: "Temperamento General",
                temperamentSelect: "Seleccione...",
                temperamentCalm: "Tranquilo / Dócil",
                temperamentActive: "Activo / Juguetón",
                temperamentNervous: "Nervioso / Ansioso",
                temperamentAggressive: "Agresivo / Territorial",
                temperamentShy: "Tímido / Miedoso",
                activityLevel: "Nivel de Actividad",
                activityLow: "Bajo (sedentario)",
                activityModerate: "Moderado",
                activityHigh: "Alto (muy activo)",
                socialWithPets: "¿Se relaciona bien con otras mascotas?",
                someOnly: "Solo con algunos",
                behaviorNotes: "Observaciones de Comportamiento",
                behaviorPlaceholder: "Describa cualquier característica especial de comportamiento...",

                // Owner Info Section
                ownerInfo: "Información del Propietario",
                ownerData: "Datos del Propietario",
                fullName: "Nombre Completo",
                documentType: "Tipo de Documento",
                citizenId: "Cédula de Ciudadanía",
                foreignId: "Cédula de Extranjería",
                passport: "Pasaporte",
                documentNumber: "Número de Documento",
                address: "Dirección",
                city: "Ciudad",
                cellPhone: "Teléfono Celular",
                phone: "Teléfono Fijo",
                email: "Correo Electrónico",
                emergencyContact: "Contacto de Emergencia / Cuidador Secundario",
                emergencyName: "Nombre Completo",
                emergencyRelation: "Relación con el Propietario",
                emergencyPhone: "Teléfono Celular",
                emergencyLandline: "Teléfono Fijo",
                authorizedDecisions: "¿Autorizado para tomar decisiones médicas?",

                // Pathologies Section
                pathologies: "Antecedentes Patológicos",
                pathologiesDesc: "Marque las condiciones que la mascota ha presentado o presenta actualmente:",
                cardiovascular: "Cardiovascular / Respiratorio",
                musculoskeletal: "Musculoesquelético",
                digestive: "Digestivo",
                skin: "Piel / Dermatológico",
                sensory: "Ojos / Oídos",
                neurological: "Neurológico / Comportamiento",
                otherConditions: "Otras Condiciones",
                otherConditionsPlaceholder: "Describa otras condiciones no listadas arriba...",

                // Medications Section
                currentMedications: "Medicamentos Actuales",
                startDate: "Fecha Inicio",
                medication: "Medicamento",
                dose: "Dosis",
                frequency: "Frecuencia",
                reason: "Motivo",
                active: "Activo",
                finished: "Terminado",
                preventives: "Antiparasitarios y Preventivos",
                fleaTick: "Antipulgas/Garrapatas",
                product: "Producto Usado",
                lastApplication: "Última Aplicación",
                nextApplication: "Próxima Aplicación",
                dewormer: "Desparasitante Interno",
                heartworm: "Prevención de Gusano del Corazón",

                // Surgeries Section
                surgeriesHospitalizations: "Registro de Cirugías y Hospitalizaciones",
                date: "Fecha",
                procedure: "Procedimiento",
                clinic: "Clínica/Hospital",
                veterinarian: "Veterinario",
                observations: "Observaciones",
                sterilizationInfo: "Esterilización / Castración",
                sterilizedQuestion: "¿Fue esterilizado/castrado?",
                sterilizationDate: "Fecha del Procedimiento",
                sterilizationClinic: "Clínica que realizó el procedimiento",

                // Allergies Section
                allergies: "Registro de Alergias",
                foodAllergies: "Alergias Alimentarias Comunes",
                chicken: "Pollo",
                beef: "Res",
                wheat: "Trigo/Gluten",
                corn: "Maíz",
                soy: "Soya",
                dairy: "Lácteos",
                fish: "Pescado",
                eggs: "Huevos",
                medicationAllergies: "Alergias a Medicamentos",
                environmentalAllergies: "Alergias Ambientales",
                allergen: "Alérgeno",
                reaction: "Reacción",
                allergicReactions: "Reacciones Alérgicas Conocidas",
                allergicReactionsPlaceholder: "Describa las reacciones alérgicas que ha presentado la mascota (síntomas, severidad, tratamiento recibido)...",

                // Vaccines Section
                vaccines: "Esquema de Vacunación",
                dogVaccines: "Vacunas para Perros",
                catVaccines: "Vacunas para Gatos",
                dose1: "Dosis 1",
                dose2: "Dosis 2",
                dose3: "Dosis 3",
                annualBooster: "Refuerzo Anual",
                nextDate: "Próxima Fecha",
                vaccineHistory: "Historial de Vacunación",
                vaccineApplied: "Vacuna Aplicada",
                lot: "Lote",
                nextAppointment: "Próxima Cita",

                // Veterinarians Section
                veterinarians: "Veterinarios",
                mainVeterinarian: "Veterinario Principal",
                vetName: "Nombre del Veterinario",
                specialty: "Especialidad",
                vetClinic: "Clínica Veterinaria",
                hours: "Horario de Atención",
                hoursPlaceholder: "Ej: L-V 8am-6pm",
                specialists: "Especialistas Consultados",
                emergencyClinic: "Clínica de Emergencias 24 Horas",
                clinicName: "Nombre de la Clínica",
                emergencyPhone: "Teléfono Emergencias",

                // Labs Section
                labResults: "Exámenes de Laboratorio",
                labHistory: "Historial de Exámenes",
                labHistoryDesc: "Registro de todos los exámenes de laboratorio realizados a la mascota.",
                examType: "Tipo de Examen",
                laboratory: "Laboratorio",
                result: "Resultado",
                requestingVet: "Veterinario Solicitante",
                file: "Archivo",
                addExam: "Agregar Examen",

                // Nutrition Section
                nutrition: "Nutrición y Alimentación",
                currentFood: "Alimentación Actual",
                foodType: "Tipo de Alimentación",
                foodTypeSelect: "Seleccione...",
                foodDry: "Concentrado/Croquetas",
                foodWet: "Alimento Húmedo",
                foodBarf: "Dieta BARF (cruda)",
                foodHomemade: "Comida Casera",
                foodMixed: "Mixta (varias)",
                foodBrand: "Marca/Producto Principal",
                foodBrandPlaceholder: "Ej: Royal Canin, Hills, etc.",
                foodLine: "Línea/Variedad",
                foodLinePlaceholder: "Ej: Adult, Puppy, Senior...",
                dailyAmount: "Cantidad Diaria (gramos)",
                feedingTimes: "Veces al Día",
                treatsSnacks: "Snacks y Premios",
                givesTreats: "¿Recibe snacks/premios?",
                occasionally: "Ocasionalmente",
                treatTypes: "Tipos de Snacks",
                treatTypesPlaceholder: "Ej: Carnaza, galletas, frutas...",
                weightControl: "Control de Peso",
                currentWeight: "Peso Actual (kg)",
                idealWeight: "Peso Ideal (según veterinario)",
                bodyCondition: "Condición Corporal",
                bodyCondition1: "1 - Muy delgado (caquéctico)",
                bodyCondition2: "2 - Bajo peso",
                bodyCondition3: "3 - Peso ideal",
                bodyCondition4: "4 - Sobrepeso",
                bodyCondition5: "5 - Obeso",
                weightHistory: "Historial de Peso",
                nutritionNotes: "Observaciones Nutricionales",
                nutritionNotesPlaceholder: "Indicaciones especiales del veterinario, dietas terapéuticas, suplementos...",

                // Summary Modal
                summaryTitle: "Resumen de Historia Médica Veterinaria",
                summaryOf: "Resumen de",
                petData: "Datos de la Mascota",
                alertsAllergies: "Alertas - Alergias",
                foods: "Alimentos",
                medications: "Medicamentos",
                currentMeds: "Medicamentos Actuales",
                mainVet: "Veterinario Principal",
                generatedBy: "Generado por MHM Mascota",

                // Multi-Pet System
                myPets: "Mis Mascotas",
                addNewPet: "+ Agregar Nueva Mascota",
                switchPet: "Cambiar de Mascota",
                deletePet: "Eliminar Mascota",
                confirmDelete: "¿Está seguro que desea eliminar esta mascota?",
                maxPetsReached: "Has alcanzado el límite máximo de 5 mascotas",
                newPetName: "Nombre de la nueva mascota",
                cannotDeleteLast: "No puedes eliminar la última mascota",
                petNotFound: "Mascota no encontrada",

                // Messages
                saveSuccess: "✅ Historia médica veterinaria guardada correctamente.",
                confirmExit: "¿Está seguro que desea salir?",
                thankYou: "Gracias por usar MHM Mascota.",
                autoSaving: "Auto-guardando cambios...",
                selectValidImage: "⚠️ Por favor selecciona un archivo de imagen válido.",

                // Time units
                years: "años",
                year: "año",
                months: "meses",
                month: "mes",

                // Pathology Names
                pathologyHeartMurmur: "Soplo cardíaco",
                pathologyHeartFailure: "Insuficiencia cardíaca",
                pathologyArrhythmia: "Arritmia",
                pathologyChronicCough: "Tos crónica",
                pathologyHipDysplasia: "Displasia de cadera",
                pathologyElbowDysplasia: "Displasia de codo",
                pathologyArthritis: "Artritis",
                pathologyPatellaLuxation: "Luxación de rótula",
                pathologyDiscHernia: "Hernia discal",
                pathologyGastritis: "Gastritis",
                pathologyPancreatitis: "Pancreatitis",
                pathologyIBD: "Enfermedad inflamatoria intestinal",
                pathologyIntestinalParasites: "Parásitos intestinales",
                pathologyFrequentVomiting: "Vómitos frecuentes",
                pathologyAllergicDermatitis: "Dermatitis alérgica",
                pathologyFungi: "Hongos",
                pathologyMange: "Sarna",
                pathologyHotspots: "Hotspots",
                pathologyHairLoss: "Pérdida de pelo",
                pathologyCataracts: "Cataratas",
                pathologyGlaucoma: "Glaucoma",
                pathologyRecurrentOtitis: "Otitis recurrente",
                pathologyDeafness: "Sordera",
                pathologyConjunctivitis: "Conjuntivitis",
                pathologyEpilepsy: "Epilepsia",
                pathologySeparationAnxiety: "Ansiedad por separación",
                pathologyAggression: "Agresividad",
                pathologyNoisePhobia: "Fobia a ruidos",
                pathologyVestibularSyndrome: "Síndrome vestibular",

                // Cloud Storage
                uploading: "Subiendo",
                changePhoto: "Cambiar Foto",
                cloudId: "ID Nube",
                recover: "Recuperar",
                cloudSaving: "Guardando en la nube",
                cloudSaved: "En la nube",
                savedLocally: "Guardado local",
                cloudError: "Error en la nube",
                enterCloudId: "Introduce tu ID de Nube anterior"
            },

            en: {
                // Header & Actions
                appTitle: "MHM - My Medical History - Pet",
                appSubtitle: "My Medical History - Pet",
                summary: "Summary",
                save: "Save",
                backup: "Backup",
                print: "Print",
                exit: "Exit",
                help: "Help",

                // Info Strip
                pet: "Pet",
                owner: "Owner",
                lastUpdate: "Last update",
                infoDisclaimer: "Information prepared for veterinary and pet owner use.",

                // Navigation Tabs
                tabPetInfo: "Pet Information",
                tabOwner: "Owner Information",
                tabPathologies: "Medical History",
                tabMedications: "Medications",
                tabSurgeries: "Surgeries / Hospitalizations",
                tabAllergies: "Allergies",
                tabVaccines: "Vaccines / Deworming",
                tabVets: "Veterinarians",
                tabLabs: "Laboratory Tests",
                tabNutrition: "Nutrition / Diet",

                // Pet Info Section
                petInfo: "Pet Information",
                petPhoto: "Pet Photo",
                uploadPhoto: "Upload Photo",
                petName: "Pet Name",
                microchip: "Microchip / ID",
                species: "Species",
                dog: "Dog",
                cat: "Cat",
                bird: "Bird",
                rabbit: "Rabbit",
                hamster: "Hamster",
                other: "Other",
                breed: "Breed",
                color: "Color / Coat",
                dateOfBirth: "Date of Birth",
                age: "Age",
                gender: "Gender",
                male: "Male",
                female: "Female",
                weight: "Weight (kg)",
                size: "Size",
                sizeSelect: "Select...",
                sizeMini: "Mini (up to 4 kg)",
                sizeSmall: "Small (4-10 kg)",
                sizeMedium: "Medium (10-25 kg)",
                sizeLarge: "Large (25-45 kg)",
                sizeGiant: "Giant (over 45 kg)",
                sterilized: "Spayed/Neutered",
                yes: "Yes",
                no: "No",
                temperamentBehavior: "Temperament and Behavior",
                temperament: "General Temperament",
                temperamentSelect: "Select...",
                temperamentCalm: "Calm / Docile",
                temperamentActive: "Active / Playful",
                temperamentNervous: "Nervous / Anxious",
                temperamentAggressive: "Aggressive / Territorial",
                temperamentShy: "Shy / Fearful",
                activityLevel: "Activity Level",
                activityLow: "Low (sedentary)",
                activityModerate: "Moderate",
                activityHigh: "High (very active)",
                socialWithPets: "Gets along well with other pets?",
                someOnly: "Only with some",
                behaviorNotes: "Behavior Notes",
                behaviorPlaceholder: "Describe any special behavioral characteristics...",

                // Owner Info Section
                ownerInfo: "Owner Information",
                ownerData: "Owner Information",
                fullName: "Full Name",
                documentType: "Document Type",
                citizenId: "National ID",
                foreignId: "Foreign ID",
                passport: "Passport",
                documentNumber: "Document Number",
                address: "Address",
                city: "City",
                cellPhone: "Cell Phone",
                phone: "Landline",
                email: "Email",
                emergencyContact: "Emergency Contact / Secondary Caretaker",
                emergencyName: "Full Name",
                emergencyRelation: "Relationship with Owner",
                emergencyPhone: "Cell Phone",
                emergencyLandline: "Landline",
                authorizedDecisions: "Authorized to make medical decisions?",

                // Pathologies Section
                pathologies: "Medical History",
                pathologiesDesc: "Check the conditions the pet has had or currently has:",
                cardiovascular: "Cardiovascular / Respiratory",
                musculoskeletal: "Musculoskeletal",
                digestive: "Digestive",
                skin: "Skin / Dermatological",
                sensory: "Eyes / Ears",
                neurological: "Neurological / Behavioral",
                otherConditions: "Other Conditions",
                otherConditionsPlaceholder: "Describe other conditions not listed above...",

                // Medications Section
                currentMedications: "Current Medications",
                startDate: "Start Date",
                medication: "Medication",
                dose: "Dose",
                frequency: "Frequency",
                reason: "Reason",
                active: "Active",
                finished: "Finished",
                preventives: "Parasite Prevention",
                fleaTick: "Flea/Tick Prevention",
                product: "Product Used",
                lastApplication: "Last Application",
                nextApplication: "Next Application",
                dewormer: "Internal Dewormer",
                heartworm: "Heartworm Prevention",

                // Surgeries Section
                surgeriesHospitalizations: "Surgery and Hospitalization Records",
                date: "Date",
                procedure: "Procedure",
                clinic: "Clinic/Hospital",
                veterinarian: "Veterinarian",
                observations: "Notes",
                sterilizationInfo: "Spay/Neuter",
                sterilizedQuestion: "Was spayed/neutered?",
                sterilizationDate: "Procedure Date",
                sterilizationClinic: "Clinic that performed the procedure",

                // Allergies Section
                allergies: "Allergy Records",
                foodAllergies: "Common Food Allergies",
                chicken: "Chicken",
                beef: "Beef",
                wheat: "Wheat/Gluten",
                corn: "Corn",
                soy: "Soy",
                dairy: "Dairy",
                fish: "Fish",
                eggs: "Eggs",
                medicationAllergies: "Medication Allergies",
                environmentalAllergies: "Environmental Allergies",
                allergen: "Allergen",
                reaction: "Reaction",
                allergicReactions: "Known Allergic Reactions",
                allergicReactionsPlaceholder: "Describe allergic reactions the pet has had (symptoms, severity, treatment received)...",

                // Vaccines Section
                vaccines: "Vaccination Schedule",
                dogVaccines: "Dog Vaccines",
                catVaccines: "Cat Vaccines",
                dose1: "Dose 1",
                dose2: "Dose 2",
                dose3: "Dose 3",
                annualBooster: "Annual Booster",
                nextDate: "Next Date",
                vaccineHistory: "Vaccination History",
                vaccineApplied: "Vaccine Applied",
                lot: "Lot",
                nextAppointment: "Next Appointment",

                // Veterinarians Section
                veterinarians: "Veterinarians",
                mainVeterinarian: "Primary Veterinarian",
                vetName: "Veterinarian Name",
                specialty: "Specialty",
                vetClinic: "Veterinary Clinic",
                hours: "Office Hours",
                hoursPlaceholder: "Ex: Mon-Fri 8am-6pm",
                specialists: "Consulted Specialists",
                emergencyClinic: "24-Hour Emergency Clinic",
                clinicName: "Clinic Name",
                emergencyPhone: "Emergency Phone",

                // Labs Section
                labResults: "Laboratory Tests",
                labHistory: "Test History",
                labHistoryDesc: "Record of all laboratory tests performed on the pet.",
                examType: "Test Type",
                laboratory: "Laboratory",
                result: "Result",
                requestingVet: "Requesting Veterinarian",
                file: "File",
                addExam: "Add Test",

                // Nutrition Section
                nutrition: "Nutrition and Feeding",
                currentFood: "Current Food",
                foodType: "Food Type",
                foodTypeSelect: "Select...",
                foodDry: "Dry/Kibble",
                foodWet: "Wet Food",
                foodBarf: "BARF Diet (raw)",
                foodHomemade: "Homemade",
                foodMixed: "Mixed (various)",
                foodBrand: "Main Brand/Product",
                foodBrandPlaceholder: "Ex: Royal Canin, Hills, etc.",
                foodLine: "Line/Variety",
                foodLinePlaceholder: "Ex: Adult, Puppy, Senior...",
                dailyAmount: "Daily Amount (grams)",
                feedingTimes: "Times per Day",
                treatsSnacks: "Treats and Snacks",
                givesTreats: "Receives treats/snacks?",
                occasionally: "Occasionally",
                treatTypes: "Snack Types",
                treatTypesPlaceholder: "Ex: Rawhide, biscuits, fruits...",
                weightControl: "Weight Control",
                currentWeight: "Current Weight (kg)",
                idealWeight: "Ideal Weight (per veterinarian)",
                bodyCondition: "Body Condition",
                bodyCondition1: "1 - Very thin (cachectic)",
                bodyCondition2: "2 - Underweight",
                bodyCondition3: "3 - Ideal weight",
                bodyCondition4: "4 - Overweight",
                bodyCondition5: "5 - Obese",
                weightHistory: "Weight History",
                nutritionNotes: "Nutritional Notes",
                nutritionNotesPlaceholder: "Special veterinary instructions, therapeutic diets, supplements...",

                // Summary Modal
                summaryTitle: "Veterinary Medical History Summary",
                summaryOf: "Summary of",
                petData: "Pet Information",
                alertsAllergies: "Alerts - Allergies",
                foods: "Foods",
                medications: "Medications",
                currentMeds: "Current Medications",
                mainVet: "Primary Veterinarian",
                generatedBy: "Generated by MHM Pet",

                // Multi-Pet System
                myPets: "My Pets",
                addNewPet: "+ Add New Pet",
                switchPet: "Switch Pet",
                deletePet: "Delete Pet",
                confirmDelete: "Are you sure you want to delete this pet?",
                maxPetsReached: "You have reached the maximum limit of 5 pets",
                newPetName: "New pet name",
                cannotDeleteLast: "You cannot delete the last pet",
                petNotFound: "Pet not found",

                // Messages
                saveSuccess: "✅ Veterinary medical history saved successfully.",
                confirmExit: "Are you sure you want to exit?",
                thankYou: "Thank you for using MHM Pet.",
                autoSaving: "Auto-saving changes...",
                selectValidImage: "⚠️ Please select a valid image file.",

                // Time units
                years: "years",
                year: "year",
                months: "months",
                month: "month",

                // Pathology Names
                pathologyHeartMurmur: "Heart murmur",
                pathologyHeartFailure: "Heart failure",
                pathologyArrhythmia: "Arrhythmia",
                pathologyChronicCough: "Chronic cough",
                pathologyHipDysplasia: "Hip dysplasia",
                pathologyElbowDysplasia: "Elbow dysplasia",
                pathologyArthritis: "Arthritis",
                pathologyPatellaLuxation: "Patella luxation",
                pathologyDiscHernia: "Disc hernia",
                pathologyGastritis: "Gastritis",
                pathologyPancreatitis: "Pancreatitis",
                pathologyIBD: "Inflammatory bowel disease",
                pathologyIntestinalParasites: "Intestinal parasites",
                pathologyFrequentVomiting: "Frequent vomiting",
                pathologyAllergicDermatitis: "Allergic dermatitis",
                pathologyFungi: "Fungi",
                pathologyMange: "Mange",
                pathologyHotspots: "Hotspots",
                pathologyHairLoss: "Hair loss",
                pathologyCataracts: "Cataracts",
                pathologyGlaucoma: "Glaucoma",
                pathologyRecurrentOtitis: "Recurrent otitis",
                pathologyDeafness: "Deafness",
                pathologyConjunctivitis: "Conjunctivitis",
                pathologyEpilepsy: "Epilepsy",
                pathologySeparationAnxiety: "Separation anxiety",
                pathologyAggression: "Aggression",
                pathologyNoisePhobia: "Noise phobia",
                pathologyVestibularSyndrome: "Vestibular syndrome",

                // Cloud Storage
                uploading: "Uploading",
                changePhoto: "Change Photo",
                cloudId: "Cloud ID",
                recover: "Recover",
                cloudSaving: "Saving to cloud",
                cloudSaved: "Saved to cloud",
                savedLocally: "Saved locally",
                cloudError: "Cloud error",
                enterCloudId: "Enter your previous Cloud ID"
            }
        };

        // Current language (default: Spanish)
        // Uses localStorage initially, then syncs with hybridStorage when ready
        let currentLanguage = 'es';
        try {
            currentLanguage = localStorage.getItem('mhm-mascota-multi-language') || 'es';
        } catch (e) {
            console.warn('Could not access localStorage for language');
        }

        // Get translation function
        function t(key) {
            return TRANSLATIONS[currentLanguage]?.[key] || TRANSLATIONS['es']?.[key] || key;
        }

        // Change language (uses hybrid storage when available)
        function setLanguage(lang) {
            if (TRANSLATIONS[lang]) {
                currentLanguage = lang;
                // Try hybrid storage first if available
                if (typeof hybridStorage !== 'undefined') {
                    hybridStorage.setItem('mhm-mascota-multi-language', lang);
                }
                // Also try localStorage as backup
                try {
                    localStorage.setItem('mhm-mascota-multi-language', lang);
                } catch (e) {
                    console.warn('Could not save language to localStorage');
                }
                updateUILanguage();
            }
        }

        // Update all UI elements with current language
        function updateUILanguage() {
            // Update elements with data-i18n attributes
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = t(key);

                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    if (element.placeholder !== undefined) {
                        element.placeholder = translation;
                    }
                } else {
                    // Preserve icons if they exist
                    const icon = element.querySelector('i');
                    if (icon) {
                        const iconHTML = icon.outerHTML;
                        // Check if there's a <br> after the icon
                        if (element.innerHTML.includes('<br>')) {
                            element.innerHTML = iconHTML + '<br>' + translation;
                        } else {
                            element.innerHTML = iconHTML + ' ' + translation;
                        }
                    } else {
                        element.textContent = translation;
                    }
                }
            });

            // Update HTML lang attribute
            document.documentElement.lang = currentLanguage;

            // Update pet selector button text
            const addPetBtn = document.getElementById('pet-add-btn');
            if (addPetBtn) {
                const icon = addPetBtn.querySelector('i');
                if (icon) {
                    addPetBtn.innerHTML = icon.outerHTML + ' ' + t('addNewPet');
                }
            }

            // Update info strip owner label
            const infoOwner = document.getElementById('info-owner');
            if (infoOwner && typeof petManager !== 'undefined') {
                const currentPet = petManager.getCurrentPet();
                const ownerName = currentPet?.data?.ownerInfo?.name || '—';
                infoOwner.textContent = `${t('owner')}: ${ownerName}`;
            }

            // Update species selector text
            document.querySelectorAll('.species-option span[data-i18n]').forEach(span => {
                const key = span.getAttribute('data-i18n');
                span.textContent = t(key);
            });

            // Re-initialize pathologies with translated names if already initialized
            const pathoCardio = document.getElementById('patho-cardio');
            if (pathoCardio && pathoCardio.hasChildNodes()) {
                // Clear and re-initialize with new language
                ['patho-cardio', 'patho-musculo', 'patho-digestive', 'patho-skin', 'patho-sensory', 'patho-neuro'].forEach(id => {
                    const container = document.getElementById(id);
                    if (container) container.innerHTML = '';
                });
                if (typeof initializePathologies === 'function') {
                    initializePathologies();
                    // Re-render saved pathologies if renderPathologies exists
                    if (typeof renderPathologies === 'function') {
                        renderPathologies();
                    }
                }
            }
        }


        // ============================================
        // HYBRID STORAGE MANAGER v1.0
        // Uses IndexedDB with localStorage fallback
        // Solves iframe storage issues on mobile Safari (ITP)
        // ============================================

        class HybridStorageManager {
            constructor() {
                this.dbName = 'MHM_Mascota_Multi_DB';
                this.dbVersion = 1;
                this.storeName = 'appData';
                this.db = null;
                this.useIndexedDB = true;
                this.isReady = false;
                this.readyPromise = this.init();
            }

            // Initialize storage - try IndexedDB first, fallback to localStorage
            async init() {
                try {
                    // Test if we're in a context where storage is available
                    if (!this.isStorageAvailable()) {
                        console.warn('⚠️ Storage restricted (iframe/mobile). Using memory fallback.');
                        this.useIndexedDB = false;
                        this.memoryStorage = {};
                        this.isReady = true;
                        return true;
                    }

                    // Try IndexedDB
                    this.db = await this.openDatabase();
                    this.useIndexedDB = true;
                    console.log('✅ IndexedDB initialized successfully');
                    this.isReady = true;
                    return true;
                } catch (error) {
                    console.warn('⚠️ IndexedDB failed, using localStorage fallback:', error.message);
                    this.useIndexedDB = false;
                    this.isReady = true;
                    return true;
                }
            }

            // Check if storage is available (detects iframe restrictions)
            isStorageAvailable() {
                try {
                    const testKey = '__storage_test__';
                    localStorage.setItem(testKey, testKey);
                    localStorage.removeItem(testKey);
                    return true;
                } catch (e) {
                    return false;
                }
            }

            // Open IndexedDB database
            openDatabase() {
                return new Promise((resolve, reject) => {
                    if (!window.indexedDB) {
                        reject(new Error('IndexedDB not supported'));
                        return;
                    }

                    const request = indexedDB.open(this.dbName, this.dbVersion);

                    request.onerror = () => {
                        reject(new Error('Failed to open IndexedDB'));
                    };

                    request.onsuccess = () => {
                        resolve(request.result);
                    };

                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains(this.storeName)) {
                            db.createObjectStore(this.storeName, { keyPath: 'key' });
                            console.log('📦 IndexedDB store created');
                        }
                    };
                });
            }

            // Wait for storage to be ready
            async waitForReady() {
                if (this.isReady) return true;
                return await this.readyPromise;
            }

            // Get item from storage
            async getItem(key) {
                await this.waitForReady();

                // Memory fallback (for restricted contexts)
                if (this.memoryStorage) {
                    return this.memoryStorage[key] || null;
                }

                if (this.useIndexedDB && this.db) {
                    try {
                        return await this.getFromIndexedDB(key);
                    } catch (error) {
                        console.warn('IndexedDB get failed, trying localStorage:', error);
                        return this.getFromLocalStorage(key);
                    }
                }
                return this.getFromLocalStorage(key);
            }

            // Set item in storage
            async setItem(key, value) {
                await this.waitForReady();

                // Memory fallback (for restricted contexts)
                if (this.memoryStorage) {
                    this.memoryStorage[key] = value;
                    console.log('💾 Saved to memory (restricted mode):', key);
                    return true;
                }

                if (this.useIndexedDB && this.db) {
                    try {
                        await this.setToIndexedDB(key, value);
                        // Also save to localStorage as backup
                        this.setToLocalStorage(key, value);
                        return true;
                    } catch (error) {
                        console.warn('IndexedDB set failed, using localStorage:', error);
                        return this.setToLocalStorage(key, value);
                    }
                }
                return this.setToLocalStorage(key, value);
            }

            // Remove item from storage
            async removeItem(key) {
                await this.waitForReady();

                if (this.memoryStorage) {
                    delete this.memoryStorage[key];
                    return true;
                }

                if (this.useIndexedDB && this.db) {
                    try {
                        await this.removeFromIndexedDB(key);
                    } catch (error) {
                        console.warn('IndexedDB remove failed');
                    }
                }
                try {
                    localStorage.removeItem(key);
                } catch (e) {
                    // Ignore
                }
                return true;
            }

            // IndexedDB operations
            getFromIndexedDB(key) {
                return new Promise((resolve, reject) => {
                    try {
                        const transaction = this.db.transaction([this.storeName], 'readonly');
                        const store = transaction.objectStore(this.storeName);
                        const request = store.get(key);

                        request.onsuccess = () => {
                            resolve(request.result ? request.result.value : null);
                        };
                        request.onerror = () => reject(request.error);
                    } catch (error) {
                        reject(error);
                    }
                });
            }

            setToIndexedDB(key, value) {
                return new Promise((resolve, reject) => {
                    try {
                        const transaction = this.db.transaction([this.storeName], 'readwrite');
                        const store = transaction.objectStore(this.storeName);
                        const request = store.put({ key, value });

                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    } catch (error) {
                        reject(error);
                    }
                });
            }

            removeFromIndexedDB(key) {
                return new Promise((resolve, reject) => {
                    try {
                        const transaction = this.db.transaction([this.storeName], 'readwrite');
                        const store = transaction.objectStore(this.storeName);
                        const request = store.delete(key);

                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    } catch (error) {
                        reject(error);
                    }
                });
            }

            // LocalStorage operations (fallback)
            getFromLocalStorage(key) {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    console.warn('localStorage get failed:', e);
                    return null;
                }
            }

            setToLocalStorage(key, value) {
                try {
                    localStorage.setItem(key, value);
                    return true;
                } catch (e) {
                    console.warn('localStorage set failed:', e);
                    return false;
                }
            }

            // Get storage mode info (for debugging)
            getStorageMode() {
                if (this.memoryStorage) return 'memory (restricted)';
                if (this.useIndexedDB) return 'IndexedDB + localStorage backup';
                return 'localStorage only';
            }
        }

        // Create global storage instance
        const hybridStorage = new HybridStorageManager();

        // ============================================
        // GOOGLE SHEETS + DRIVE STORAGE MANAGER v1.0
        // Cloud backup for pet data
        // ============================================
        class GoogleCloudStorage {
            constructor() {
                // ==================================================
                // CONFIGURACIÓN - Pega aquí tu URL de Apps Script
                // ==================================================
                this.scriptURL = "https://script.google.com/macros/s/AKfycbxIqeThUiJhj298q3zbcOhc8VWiT5yvKlBoxwGqLQTwMEnrIXW5DH9Jhd2LuLS5rddaiA/exec";
                // ==================================================

                this.isConfigured = this.scriptURL && !this.scriptURL.includes("PEGA_AQUI");
                this.userId = null;
                this.initUserId();
            }

            // Initialize user ID
            initUserId() {
                try {
                    this.userId = localStorage.getItem('mhm_cloud_id');
                } catch (e) {
                    // localStorage not available
                }

                if (!this.userId) {
                    this.userId = 'MHM-' + Math.random().toString(36).substr(2, 4).toUpperCase();
                    try {
                        localStorage.setItem('mhm_cloud_id', this.userId);
                    } catch (e) {
                        // Can't save, but keep in memory
                    }
                    // Show alert after UI is ready
                    setTimeout(() => {
                        if (this.isConfigured) {
                            this.showCloudIdAlert();
                        }
                    }, 3000);
                }
            }

            // Show cloud ID alert
            showCloudIdAlert() {
                const lang = (typeof currentLanguage !== 'undefined') ? currentLanguage : 'es';
                const msg = lang === 'en'
                    ? `⚠️ YOUR CLOUD ID: ${this.userId}\n\nSave it! If the app resets, you'll need it to recover your data.`
                    : `⚠️ TU ID DE NUBE: ${this.userId}\n\nGuárdalo. Si la app se reinicia, lo necesitarás para recuperar tus datos.`;
                alert(msg);
            }

            // Render cloud ID in footer
            renderFooterID() {
                if (!this.isConfigured) return;

                const footer = document.querySelector('.mhm-info-disclaimer');
                if (footer) {
                    // Remove existing cloud ID element if present
                    const existing = document.getElementById('cloud-id-display');
                    if (existing) existing.remove();

                    const lang = (typeof currentLanguage !== 'undefined') ? currentLanguage : 'es';
                    const el = document.createElement('div');
                    el.id = 'cloud-id-display';
                    el.style.cssText = "margin-top:10px; background:#e3f2fd; padding:8px 12px; border-radius:8px; text-align:center; color:#1565c0; font-weight:bold; border: 1px solid #90caf9;";
                    el.innerHTML = `
                        <span style="display:inline-flex; align-items:center; gap:8px;">
                            ☁️ ${lang === 'en' ? 'Cloud ID' : 'ID Nube'}: <code style="background:#fff; padding:2px 8px; border-radius:4px; color:#333;">${this.userId}</code>
                            <button onclick="cloudStorage.promptRecoverData()" style="cursor:pointer; background:#1565c0; color:white; border:none; padding:4px 10px; border-radius:4px; font-size:0.8rem;">
                                🔄 ${lang === 'en' ? 'Recover' : 'Recuperar'}
                            </button>
                        </span>
                    `;
                    footer.appendChild(el);
                }
            }

            // Prompt to recover data from another ID
            promptRecoverData() {
                const lang = (typeof currentLanguage !== 'undefined') ? currentLanguage : 'es';
                const promptMsg = lang === 'en'
                    ? "Enter your previous Cloud ID (e.g., MHM-XXXX):"
                    : "Introduce tu ID de Nube anterior (ej: MHM-XXXX):";
                const code = prompt(promptMsg, "");

                if (code && code.trim().length > 3) {
                    const newId = code.trim().toUpperCase();
                    const confirmMsg = lang === 'en'
                        ? `Recover data for ID: ${newId}?\n\nThis will replace your current local data.`
                        : `¿Recuperar datos para ID: ${newId}?\n\nEsto reemplazará tus datos locales actuales.`;

                    if (confirm(confirmMsg)) {
                        try {
                            // Clear local pet data to force reload from cloud
                            localStorage.removeItem('mhm-mascota-multi-pets-data');
                            localStorage.removeItem('mhm-mascota-multi-current-pet-id');

                            // Clear IndexedDB data if possible
                            if (typeof hybridStorage !== 'undefined') {
                                hybridStorage.removeItem('mhm-mascota-multi-pets-data');
                                hybridStorage.removeItem('mhm-mascota-multi-current-pet-id');
                            }

                            // Set new cloud ID
                            localStorage.setItem('mhm_cloud_id', newId);

                            console.log('☁️ Switching to cloud ID:', newId);
                        } catch (e) {
                            console.error('Error during recovery:', e);
                        }

                        // Reload page to fetch data from cloud
                        location.reload();
                    }
                }
            }

            // Upload image to Google Drive
            async uploadImage(base64Image) {
                if (!this.isConfigured) {
                    console.warn('☁️ Cloud storage not configured');
                    return null;
                }

                // Skip if image is too large (> 4MB in base64)
                if (base64Image.length > 4 * 1024 * 1024) {
                    console.warn('☁️ Image too large for cloud upload, using local storage');
                    return null;
                }

                console.log('☁️ Uploading image to cloud...');

                try {
                    // Google Apps Script Web Apps redirect, so we need to handle that
                    const res = await fetch(this.scriptURL, {
                        method: 'POST',
                        redirect: 'follow', // Important for Google Apps Script
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8'
                        },
                        body: JSON.stringify({
                            action: "uploadImage",
                            image: base64Image
                        })
                    });

                    // Try to parse the response
                    const text = await res.text();
                    console.log('☁️ Upload response:', text.substring(0, 200));

                    try {
                        const json = JSON.parse(text);
                        if (json.status === "success" && json.url) {
                            console.log('☁️ Image uploaded successfully:', json.url);
                            return json.url;
                        } else {
                            console.warn('☁️ Image upload failed:', json.message || 'Unknown error');
                            return null;
                        }
                    } catch (parseError) {
                        console.warn('☁️ Could not parse upload response:', parseError);
                        return null;
                    }
                } catch (e) {
                    // Silent fail - don't bother user with alerts
                    console.warn('☁️ Image upload error (using local storage instead):', e.message);
                    return null;
                }
            }

            // Save data to Google Sheets
            async save(data) {
                if (!this.isConfigured) {
                    console.log('☁️ Cloud storage not configured - skipping cloud save');
                    return false;
                }

                console.log('☁️ Saving data to cloud for user:', this.userId);

                // Visual indicator
                const dateEl = document.getElementById('info-date');
                const originalText = dateEl ? dateEl.innerText : '';
                if (dateEl) {
                    const lang = (typeof currentLanguage !== 'undefined') ? currentLanguage : 'es';
                    dateEl.innerText = lang === 'en' ? "☁️ Saving..." : "☁️ Guardando...";
                }

                try {
                    const response = await fetch(this.scriptURL, {
                        method: 'POST',
                        redirect: 'follow',
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify({ id: this.userId, data: data })
                    });

                    const text = await response.text();
                    console.log('☁️ Save response:', text.substring(0, 100));

                    if (dateEl) {
                        const lang = (typeof currentLanguage !== 'undefined') ? currentLanguage : 'es';
                        try {
                            const json = JSON.parse(text);
                            if (json.status === 'success') {
                                dateEl.innerText = lang === 'en' ? "✅ Saved" : "✅ Guardado";
                            } else {
                                dateEl.innerText = lang === 'en' ? "⚠️ Save issue" : "⚠️ Problema al guardar";
                            }
                        } catch (e) {
                            dateEl.innerText = lang === 'en' ? "✅ Saved" : "✅ Guardado";
                        }
                        // Restore original after 2 seconds
                        setTimeout(() => {
                            if (dateEl) dateEl.innerText = originalText || new Date().toLocaleDateString();
                        }, 2000);
                    }

                    console.log('☁️ Data saved to cloud successfully');
                    return true;
                } catch (e) {
                    console.error('☁️ Cloud save error:', e);
                    if (dateEl) {
                        const lang = (typeof currentLanguage !== 'undefined') ? currentLanguage : 'es';
                        dateEl.innerText = lang === 'en' ? "❌ Error" : "❌ Error";
                        setTimeout(() => {
                            if (dateEl) dateEl.innerText = originalText;
                        }, 3000);
                    }
                    return false;
                }
            }

            // Load data from Google Sheets
            async load() {
                if (!this.isConfigured) {
                    console.log('☁️ Cloud storage not configured - skipping cloud load');
                    return null;
                }

                console.log('☁️ Loading data from cloud for user:', this.userId);

                try {
                    const url = this.scriptURL + "?action=read&id=" + encodeURIComponent(this.userId);
                    console.log('☁️ Load URL:', url);

                    const response = await fetch(url, {
                        method: 'GET',
                        redirect: 'follow'
                    });

                    const text = await response.text();
                    console.log('☁️ Load response:', text.substring(0, 200));

                    if (!text || text.trim() === '' || text === 'null') {
                        console.log('☁️ No data found in cloud for this user');
                        return null;
                    }

                    try {
                        const data = JSON.parse(text);
                        if (data && data.status === 'not_found') {
                            console.log('☁️ User not found in cloud');
                            return null;
                        }
                        console.log('☁️ Data loaded from cloud successfully');
                        return data;
                    } catch (parseError) {
                        console.warn('☁️ Could not parse cloud data:', parseError);
                        return null;
                    }
                } catch (e) {
                    console.error('☁️ Cloud load error:', e);
                    return null;
                }
            }

            // Check if cloud storage is configured
            isReady() {
                return this.isConfigured;
            }

            // Get cloud ID
            getCloudId() {
                return this.userId;
            }
        }

        // Create global cloud storage instance
        const cloudStorage = new GoogleCloudStorage();

        // ============================================
        // MULTI-PET MANAGER v2.3
        // Uses HybridStorageManager + GoogleCloudStorage
        // Local + Cloud sync for maximum reliability
        // ============================================

        class MultiPetManager {
            constructor() {
                this.maxPets = 5;
                this.currentPetId = null;
                this.storageKey = 'mhm-mascota-multi-pets-data';
                this.currentPetKey = 'mhm-mascota-multi-current-pet-id';
                this.pets = [];
                this.isInitialized = false;
                this.initPromise = null;

                // Start async initialization
                this.initPromise = this.init();
            }

            // Async initialization
            async init() {
                try {
                    // Wait for hybrid storage to be ready
                    await hybridStorage.waitForReady();

                    // Load pets from hybrid storage (local)
                    this.pets = await this.loadPetsAsync();

                    // If no local pets, try loading from cloud
                    if (this.pets.length === 0 && typeof cloudStorage !== 'undefined' && cloudStorage.isReady()) {
                        console.log('☁️ No local data found, checking cloud...');
                        const cloudData = await this.loadFromCloud();
                        if (cloudData && cloudData.pets && cloudData.pets.length > 0) {
                            console.log('☁️ Restoring data from cloud:', cloudData.pets.length, 'pets');
                            this.pets = cloudData.pets;
                            if (cloudData.currentPetId) {
                                this.currentPetId = cloudData.currentPetId;
                            }
                            // Save to local storage for future use
                            await this.savePetsAsync();
                        }
                    }

                    // If still no pets exist, create a default one
                    if (this.pets.length === 0) {
                        await this.createDefaultPetAsync();
                    }

                    // Set current pet (last used or first available)
                    const savedCurrentPetId = await hybridStorage.getItem(this.currentPetKey);
                    this.currentPetId = savedCurrentPetId || this.pets[0].id;

                    // Ensure current pet exists
                    if (!this.pets.find(p => p.id === this.currentPetId)) {
                        this.currentPetId = this.pets[0].id;
                    }

                    this.isInitialized = true;
                    console.log('🐾 MultiPetManager initialized:', this.pets.length, 'pets');
                    console.log('📦 Storage mode:', hybridStorage.getStorageMode());
                    if (typeof cloudStorage !== 'undefined') {
                        console.log('☁️ Cloud storage:', cloudStorage.isReady() ? 'Configured' : 'Not configured');
                    }

                    // Dispatch event to notify app that data is ready
                    window.dispatchEvent(new CustomEvent('petManagerReady', { detail: { pets: this.pets } }));

                    return true;
                } catch (error) {
                    console.error('❌ Error initializing MultiPetManager:', error);
                    // Fallback: create default pet in memory
                    this.createDefaultPetSync();
                    this.isInitialized = true;
                    return false;
                }
            }

            // Wait for initialization
            async waitForReady() {
                if (this.isInitialized) return true;
                return await this.initPromise;
            }

            // Get current language safely
            getCurrentLanguage() {
                return (typeof currentLanguage !== 'undefined') ? currentLanguage : 'es';
            }

            // Load all pets from hybrid storage (async)
            async loadPetsAsync() {
                try {
                    const petsData = await hybridStorage.getItem(this.storageKey);
                    if (petsData) {
                        const parsed = typeof petsData === 'string' ? JSON.parse(petsData) : petsData;
                        console.log('📂 Loaded pets from hybrid storage:', parsed.length);
                        return parsed;
                    }
                } catch (e) {
                    console.error('Error loading pets:', e);
                }
                return [];
            }

            // Sync version for fallback - uses localStorage directly
            loadPets() {
                try {
                    const petsData = localStorage.getItem(this.storageKey);
                    if (petsData) {
                        const parsed = JSON.parse(petsData);
                        return parsed;
                    }
                } catch (e) {
                    console.warn('localStorage fallback load failed:', e);
                }
                return this.pets; // Return current in-memory pets
            }

            // Save all pets to hybrid storage (async)
            async savePetsAsync() {
                try {
                    const dataStr = JSON.stringify(this.pets);
                    await hybridStorage.setItem(this.storageKey, dataStr);
                    console.log('💾 Pets saved to hybrid storage');
                    return true;
                } catch (e) {
                    console.error('Error saving pets:', e);
                    const errorMsg = this.getCurrentLanguage() === 'en'
                        ? 'Error saving data. Storage may be full.'
                        : 'Error al guardar los datos. El almacenamiento puede estar lleno.';
                    console.warn(errorMsg);
                    return false;
                }
            }

            // Sync save for immediate operations (triggers async save + cloud)
            savePets() {
                // Trigger async save in background (local)
                this.savePetsAsync().catch(e => console.error('Background save failed:', e));

                // Also try localStorage as immediate backup
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(this.pets));
                } catch (e) {
                    // Ignore - hybrid storage will handle it
                }

                // Trigger cloud save in background (debounced)
                this.scheduleCloudSave();

                return true;
            }

            // Debounced cloud save to avoid too many requests
            scheduleCloudSave() {
                // Clear previous timeout
                if (this.cloudSaveTimeout) {
                    clearTimeout(this.cloudSaveTimeout);
                }

                // Schedule cloud save after 2 seconds of inactivity
                this.cloudSaveTimeout = setTimeout(() => {
                    this.saveToCloud();
                }, 2000);
            }

            // Save to cloud storage
            async saveToCloud() {
                if (typeof cloudStorage !== 'undefined' && cloudStorage.isReady()) {
                    try {
                        const dataToSave = {
                            version: '2.3',
                            savedAt: new Date().toISOString(),
                            currentPetId: this.currentPetId,
                            pets: this.pets
                        };
                        await cloudStorage.save(dataToSave);
                    } catch (e) {
                        console.error('☁️ Cloud save failed:', e);
                    }
                }
            }

            // Load from cloud storage
            async loadFromCloud() {
                if (typeof cloudStorage !== 'undefined' && cloudStorage.isReady()) {
                    try {
                        const cloudData = await cloudStorage.load();
                        if (cloudData && cloudData.pets && cloudData.pets.length > 0) {
                            console.log('☁️ Found cloud data:', cloudData.pets.length, 'pets');
                            return cloudData;
                        }
                    } catch (e) {
                        console.error('☁️ Cloud load failed:', e);
                    }
                }
                return null;
            }

            // Create default pet (async)
            async createDefaultPetAsync() {
                const defaultPet = {
                    id: this.generateId(),
                    name: 'Max',
                    species: 'Perro',
                    breed: 'Golden Retriever',
                    createdAt: new Date().toISOString(),
                    data: this.getEmptyPetData()
                };
                defaultPet.data.petInfo.name = defaultPet.name;
                defaultPet.data.petInfo.species = 'perro';
                defaultPet.data.petInfo.breed = 'Golden Retriever';
                this.pets.push(defaultPet);
                await this.savePetsAsync();
                console.log('🐕 Default pet created:', defaultPet.name);
            }

            // Sync fallback for constructor
            createDefaultPetSync() {
                const defaultPet = {
                    id: this.generateId(),
                    name: 'Max',
                    species: 'Perro',
                    breed: 'Golden Retriever',
                    createdAt: new Date().toISOString(),
                    data: this.getEmptyPetData()
                };
                defaultPet.data.petInfo.name = defaultPet.name;
                defaultPet.data.petInfo.species = 'perro';
                defaultPet.data.petInfo.breed = 'Golden Retriever';
                this.pets.push(defaultPet);
                this.currentPetId = defaultPet.id;
                this.savePets();
                console.log('🐕 Default pet created (sync):', defaultPet.name);
            }

            // Generate unique ID
            generateId() {
                return 'pet_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            // Get empty pet data structure
            getEmptyPetData() {
                return {
                    petInfo: {
                        name: '',
                        microchip: '',
                        species: '',
                        breed: '',
                        color: '',
                        dateOfBirth: '',
                        gender: '',
                        weight: '',
                        size: '',
                        sterilized: false,
                        temperament: '',
                        activityLevel: '',
                        social: '',
                        behaviorNotes: '',
                        photo: ''
                    },
                    ownerInfo: {
                        name: '',
                        idType: 'CC',
                        idNumber: '',
                        address: '',
                        city: '',
                        phone: '',
                        cellPhone: '',
                        email: '',
                        emergencyContact: {
                            name: '',
                            relation: '',
                            cellPhone: '',
                            phone: '',
                            authorized: false
                        }
                    },
                    pathologies: {
                        cardio: [],
                        musculo: [],
                        digestive: [],
                        skin: [],
                        sensory: [],
                        neuro: [],
                        other: ''
                    },
                    medications: [],
                    preventives: {
                        fleaTick: { product: '', lastDate: '', nextDate: '' },
                        dewormer: { product: '', lastDate: '', nextDate: '' },
                        heartworm: { product: '', lastDate: '', nextDate: '' }
                    },
                    surgeries: [],
                    sterilization: {
                        done: false,
                        date: '',
                        clinic: ''
                    },
                    allergies: {
                        food: [],
                        medications: [],
                        environmental: [],
                        reactions: ''
                    },
                    vaccines: {
                        dog: [],
                        cat: [],
                        history: []
                    },
                    vetVisits: [],
                    nutrition: {
                        foodType: '',
                        foodBrand: '',
                        amount: '',
                        frequency: '',
                        treats: '',
                        restrictions: ''
                    },
                    grooming: {
                        bathFrequency: '',
                        brushFrequency: '',
                        lastGrooming: '',
                        notes: ''
                    }
                };
            }

            // Get current pet
            getCurrentPet() {
                return this.pets.find(p => p.id === this.currentPetId);
            }

            // Get all pets
            getAllPets() {
                return this.pets;
            }

            // Get pet count
            getPetCount() {
                return this.pets.length;
            }

            // Check if can add more pets
            canAddPet() {
                const canAdd = this.pets.length < this.maxPets;
                console.log('Can add pet?', canAdd, `(${this.pets.length}/${this.maxPets})`);
                return canAdd;
            }

            // Switch to different pet (async-safe)
            async switchPet(petId) {
                const pet = this.pets.find(p => p.id === petId);
                if (pet) {
                    this.currentPetId = petId;
                    await hybridStorage.setItem(this.currentPetKey, petId);
                    console.log('🔄 Switched to pet:', pet.name);
                    return true;
                }
                return false;
            }

            // Add new pet - IMPROVED
            addPet(name = null, species = 'perro') {
                console.log('➕ Attempting to add new pet...');

                if (this.pets.length >= this.maxPets) {
                    const msg = this.getCurrentLanguage() === 'en'
                        ? `Maximum limit of ${this.maxPets} pets reached`
                        : `Límite máximo de ${this.maxPets} mascotas alcanzado`;
                    console.log('❌ Cannot add:', msg);
                    return { success: false, message: msg };
                }

                const lang = this.getCurrentLanguage();
                const petNumber = this.pets.length + 1;
                const petName = name || (lang === 'en' ? `Pet ${petNumber}` : `Mascota ${petNumber}`);
                const speciesName = species === 'perro' ? (lang === 'en' ? 'Dog' : 'Perro') : (lang === 'en' ? 'Cat' : 'Gato');

                const newPet = {
                    id: this.generateId(),
                    name: petName,
                    species: speciesName,
                    breed: '',
                    createdAt: new Date().toISOString(),
                    data: this.getEmptyPetData()
                };

                // Set default data
                newPet.data.petInfo.name = petName;
                newPet.data.petInfo.species = species;

                this.pets.push(newPet);
                this.savePets();

                console.log('✅ New pet added:', newPet.name);
                return { success: true, pet: newPet };
            }

            // Delete pet (async-safe)
            async deletePet(petId) {
                if (this.pets.length <= 1) {
                    const msg = this.getCurrentLanguage() === 'en'
                        ? 'Cannot delete the last pet'
                        : 'No se puede eliminar la última mascota';
                    return { success: false, message: msg };
                }

                const index = this.pets.findIndex(p => p.id === petId);
                if (index !== -1) {
                    const deletedPet = this.pets[index];
                    this.pets.splice(index, 1);

                    // If we deleted the current pet, switch to first available
                    if (this.currentPetId === petId) {
                        this.currentPetId = this.pets[0].id;
                        await hybridStorage.setItem(this.currentPetKey, this.currentPetId);
                    }

                    this.savePets();
                    console.log('🗑️ Pet deleted:', deletedPet.name);
                    return { success: true };
                }

                const msg = this.getCurrentLanguage() === 'en' ? 'Pet not found' : 'Mascota no encontrada';
                return { success: false, message: msg };
            }

            // Update current pet data
            updateCurrentPet(data) {
                const pet = this.getCurrentPet();
                if (pet) {
                    // Deep merge the data
                    pet.data = this.deepMerge(pet.data, data);

                    // Update quick access fields
                    if (data.petInfo) {
                        if (data.petInfo.name) pet.name = data.petInfo.name;
                        if (data.petInfo.species) {
                            const lang = this.getCurrentLanguage();
                            const speciesMap = {
                                'perro': lang === 'en' ? 'Dog' : 'Perro',
                                'gato': lang === 'en' ? 'Cat' : 'Gato',
                                'ave': lang === 'en' ? 'Bird' : 'Ave',
                                'conejo': lang === 'en' ? 'Rabbit' : 'Conejo',
                                'hamster': lang === 'en' ? 'Hamster' : 'Hámster',
                                'otro': lang === 'en' ? 'Other' : 'Otro'
                            };
                            pet.species = speciesMap[data.petInfo.species] || data.petInfo.species;
                        }
                        if (data.petInfo.breed) pet.breed = data.petInfo.breed;
                    }

                    this.savePets();
                    console.log('📝 Pet updated:', pet.name);
                    return true;
                }
                return false;
            }

            // Update pet photo
            updatePetPhoto(photoData) {
                const pet = this.getCurrentPet();
                if (pet) {
                    pet.data.petInfo.photo = photoData;
                    this.savePets();
                    return true;
                }
                return false;
            }

            // Deep merge objects
            deepMerge(target, source) {
                const output = Object.assign({}, target);
                if (this.isObject(target) && this.isObject(source)) {
                    Object.keys(source).forEach(key => {
                        if (this.isObject(source[key])) {
                            if (!(key in target)) {
                                Object.assign(output, { [key]: source[key] });
                            } else {
                                output[key] = this.deepMerge(target[key], source[key]);
                            }
                        } else {
                            Object.assign(output, { [key]: source[key] });
                        }
                    });
                }
                return output;
            }

            isObject(item) {
                return item && typeof item === 'object' && !Array.isArray(item);
            }

            // Export current pet data
            exportCurrentPet() {
                const pet = this.getCurrentPet();
                if (pet) {
                    const dataStr = JSON.stringify(pet, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `MHM_${pet.name}_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    URL.revokeObjectURL(url);
                }
            }

            // Export all pets
            exportAllPets() {
                const dataStr = JSON.stringify({
                    version: '2.2',
                    exportDate: new Date().toISOString(),
                    storageMode: hybridStorage.getStorageMode(),
                    pets: this.pets
                }, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `MHM_AllPets_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            }

            // Import pet data
            importPet(jsonData) {
                try {
                    const petData = JSON.parse(jsonData);

                    if (!petData.id || !petData.name || !petData.data) {
                        throw new Error('Invalid pet data structure');
                    }

                    petData.id = this.generateId();

                    if (this.pets.length >= this.maxPets) {
                        const msg = this.getCurrentLanguage() === 'en'
                            ? `Maximum limit of ${this.maxPets} pets reached`
                            : `Límite máximo de ${this.maxPets} mascotas alcanzado`;
                        return { success: false, message: msg };
                    }

                    this.pets.push(petData);
                    this.savePets();

                    return { success: true, pet: petData };
                } catch (e) {
                    return { success: false, message: 'Error importing: ' + e.message };
                }
            }

            // Get storage info (for debugging)
            getStorageInfo() {
                const info = {
                    localMode: hybridStorage.getStorageMode(),
                    petsCount: this.pets.length,
                    currentPetId: this.currentPetId,
                    isInitialized: this.isInitialized
                };

                // Add cloud info if available
                if (typeof cloudStorage !== 'undefined') {
                    info.cloudConfigured = cloudStorage.isReady();
                    info.cloudId = cloudStorage.getCloudId();
                }

                return info;
            }
        }

        // Initialize global pet manager
        const petManager = new MultiPetManager();


        // ============================================
        // MOCK DATA - MHM MASCOTA MULTI
        // Sample data for demonstration
        // ============================================

        // Pet Data
        const PET_DATA = {
            name: 'Max',
            species: 'Perro',
            breed: 'Golden Retriever',
            color: 'Dorado',
            dateOfBirth: '2020-03-15',
            age: '4 años, 10 meses',
            gender: 'macho',
            sterilized: true,
            weight: '32',
            size: 'grande',
            microchip: '900118000123456',
            temperament: 'activo',
            activityLevel: 'alto',
            social: 'si',
            behaviorNotes: 'Muy juguetón, le encanta el agua y buscar pelotas. Puede ser algo ansioso cuando se queda solo.'
        };

        // Owner Data
        const OWNER_DATA = {
            name: 'María García López',
            idType: 'CC',
            idNumber: '1020345678',
            address: 'Calle 100 #45-67, Apto 301',
            city: 'Bogotá D.C.',
            cellPhone: '+57 310 123 4567',
            phone: '+57 1 234 5678',
            email: 'maria.garcia@email.com',
            emergencyContact: {
                name: 'Carlos García',
                relation: 'Hermano',
                cellPhone: '+57 300 987 6543',
                phone: '',
                authorized: true
            }
        };

        // Pathologies Data
        const PET_PATHOLOGIES = {
            cardio: ['pathologyChronicCough'],
            musculo: ['pathologyHipDysplasia'],
            digestive: [],
            skin: ['pathologyAllergicDermatitis'],
            sensory: ['pathologyRecurrentOtitis'],
            neuro: [],
            other: ''
        };

        // Medications Data
        const PET_MEDICATIONS = [
            {
                startDate: '2024-06-01',
                name: 'Apoquel (Oclacitinib)',
                dose: '16 mg',
                frequency: 'Cada 12 horas',
                reason: 'Dermatitis alérgica',
                active: true
            },
            {
                startDate: '2024-08-15',
                name: 'Condroitina + Glucosamina',
                dose: '1500 mg',
                frequency: 'Una vez al día',
                reason: 'Displasia de cadera',
                active: true
            },
            {
                startDate: '2024-01-10',
                name: 'Otomax',
                dose: 'Gotas óticas',
                frequency: 'Cada 8 horas x 10 días',
                reason: 'Otitis',
                active: false
            }
        ];

        // Preventives Data
        const PET_PREVENTIVES = {
            fleaTick: {
                product: 'Nexgard Spectra',
                lastDate: '2024-12-01',
                nextDate: '2025-01-01'
            },
            dewormer: {
                product: 'Drontal Plus',
                lastDate: '2024-11-15',
                nextDate: '2025-02-15'
            },
            heartworm: {
                product: 'Heartgard Plus',
                lastDate: '2024-12-01',
                nextDate: '2025-01-01'
            }
        };

        // Surgeries Data
        const PET_SURGERIES = [
            {
                date: '2021-06-20',
                procedure: 'Castración',
                clinic: 'Clínica Veterinaria San Francisco',
                vet: 'Dr. Roberto Martínez',
                notes: 'Procedimiento sin complicaciones. Recuperación rápida.'
            },
            {
                date: '2023-03-10',
                procedure: 'Extracción de cuerpo extraño intestinal',
                clinic: 'Hospital Veterinario Centro',
                vet: 'Dra. Patricia Romero',
                notes: 'Ingirió una pelota de goma. Cirugía exitosa.'
            }
        ];

        // Sterilization Data
        const PET_STERILIZATION = {
            done: true,
            date: '2021-06-20',
            clinic: 'Clínica Veterinaria San Francisco'
        };

        // Allergies Data
        const PET_ALLERGIES = {
            food: ['chicken', 'wheat'],
            medications: [
                { name: 'Amoxicilina', reaction: 'Urticaria y prurito severo' }
            ],
            environmental: [
                { name: 'Polen de pasto', reaction: 'Estornudos, ojos llorosos' },
                { name: 'Ácaros del polvo', reaction: 'Prurito en patas' }
            ],
            reactions: 'Reacción alérgica severa a la amoxicilina en 2022, requirió tratamiento de emergencia con epinefrina.'
        };

        // Vaccines Data
        const PET_VACCINES = {
            dog: [
                { name: 'Parvovirus', dose1: '2020-05-15', dose2: '2020-06-15', dose3: '2020-07-15', annual: '2024-07-15', next: '2025-07-15' },
                { name: 'Moquillo', dose1: '2020-05-15', dose2: '2020-06-15', dose3: '2020-07-15', annual: '2024-07-15', next: '2025-07-15' },
                { name: 'Hepatitis', dose1: '2020-05-15', dose2: '2020-06-15', dose3: null, annual: '2024-07-15', next: '2025-07-15' },
                { name: 'Leptospirosis', dose1: '2020-06-15', dose2: '2020-07-15', dose3: null, annual: '2024-07-15', next: '2025-07-15' },
                { name: 'Rabia', dose1: '2020-08-15', dose2: null, dose3: null, annual: '2024-08-15', next: '2025-08-15' },
                { name: 'Bordetella (Tos Perruna)', dose1: '2020-09-01', dose2: null, dose3: null, annual: '2024-09-01', next: '2025-09-01' }
            ],
            cat: [
                { name: 'Triple Felina', dose1: '', dose2: '', dose3: null, annual: '', next: '' },
                { name: 'Leucemia Felina', dose1: '', dose2: '', dose3: null, annual: '', next: '' },
                { name: 'Rabia', dose1: '', dose2: null, dose3: null, annual: '', next: '' }
            ]
        };

        // Vaccine History
        const VACCINE_HISTORY = [
            { date: '2024-07-15', vaccine: 'Séxtuple Canina', lot: 'LOT2024-7890', vet: 'Dr. Roberto Martínez', clinic: 'Clínica San Francisco', nextDate: '2025-07-15' },
            { date: '2024-08-15', vaccine: 'Rabia', lot: 'RAB2024-1234', vet: 'Dr. Roberto Martínez', clinic: 'Clínica San Francisco', nextDate: '2025-08-15' },
            { date: '2024-09-01', vaccine: 'Bordetella', lot: 'BOR2024-5678', vet: 'Dr. Roberto Martínez', clinic: 'Clínica San Francisco', nextDate: '2025-09-01' }
        ];

        // Veterinarians Data
        const PET_VETS = {
            main: {
                name: 'Dr. Roberto Martínez Pérez',
                specialty: 'Medicina General',
                clinic: 'Clínica Veterinaria San Francisco',
                phone: '+57 1 345 6789',
                cell: '+57 315 234 5678',
                address: 'Carrera 15 #82-30, Local 102, Bogotá',
                hours: 'Lun-Vie 8am-6pm, Sab 9am-2pm'
            },
            specialists: [
                {
                    name: 'Dra. Ana Rodríguez',
                    specialty: 'Dermatología Veterinaria',
                    clinic: 'Centro de Especialidades Veterinarias',
                    phone: '+57 1 456 7890',
                    cell: '+57 320 345 6789'
                },
                {
                    name: 'Dr. Luis Hernández',
                    specialty: 'Ortopedia Veterinaria',
                    clinic: 'Hospital Veterinario Central',
                    phone: '+57 1 567 8901',
                    cell: '+57 318 456 7890'
                }
            ],
            emergency: {
                name: 'Hospital Veterinario 24 Horas',
                phone: '+57 1 800 123 4567',
                address: 'Autopista Norte Km 15, Bogotá'
            }
        };

        // Lab Results Data
        const PET_LABS = [
            {
                date: '2024-10-15',
                type: 'Hemograma Completo',
                lab: 'Laboratorio VetLab',
                result: 'Valores dentro de rangos normales',
                vet: 'Dr. Roberto Martínez'
            },
            {
                date: '2024-10-15',
                type: 'Química Sanguínea',
                lab: 'Laboratorio VetLab',
                result: 'Función renal y hepática normal',
                vet: 'Dr. Roberto Martínez'
            },
            {
                date: '2024-08-20',
                type: 'Radiografía de Cadera',
                lab: 'Clínica San Francisco',
                result: 'Displasia de cadera grado II bilateral',
                vet: 'Dr. Luis Hernández'
            },
            {
                date: '2024-06-10',
                type: 'Prueba de Alergias (Panel 40)',
                lab: 'VetDerm Laboratory',
                result: 'Positivo: pollo, trigo, polen de pasto, ácaros',
                vet: 'Dra. Ana Rodríguez'
            }
        ];

        // Nutrition Data
        const PET_NUTRITION = {
            foodType: 'concentrado',
            brand: 'Hill\'s Science Diet',
            line: 'Skin/Food Sensitive (Piel Sensible)',
            dailyQuantity: '400',
            frequency: 2,
            givesSnacks: true,
            snackTypes: 'Premios hipoalergénicos marca Hill\'s, zanahorias baby, manzana sin semillas',
            currentWeight: '32',
            idealWeight: '30',
            bodyCondition: 4,
            weightHistory: [
                { date: '2024-10-15', weight: '32', notes: 'Sobrepeso leve, iniciar dieta' },
                { date: '2024-07-15', weight: '31', notes: 'Peso estable' },
                { date: '2024-04-15', weight: '30', notes: 'Peso ideal' },
                { date: '2024-01-15', weight: '29', notes: 'Buen estado' }
            ],
            notes: 'Dieta hipoalergénica por alergias alimentarias diagnosticadas. Evitar: pollo, trigo, gluten. Mantener porciones controladas por sobrepeso actual.'
        };


        /**
         * MHM Mascota Multi - Historia Médica Veterinaria
         * Main Application JavaScript
         * Bilingual (ES/EN) - Max 5 Pets
         */

        // ==========================================
        // INITIALIZATION
        // ==========================================

        // Simple initialization function (async to wait for storage)
        async function initMHMApp() {
            console.log('🐾 MHM Mascota Multi - Iniciando aplicación...');

            // Wait for petManager to be fully initialized (IndexedDB ready)
            try {
                await petManager.waitForReady();
                console.log('📦 Storage ready:', hybridStorage.getStorageMode());
            } catch (error) {
                console.warn('⚠️ Storage initialization had issues, continuing with defaults:', error);
            }

            // Initialize language UI first
            initializeLanguageUI();

            // Initialize pet selector
            initializePetSelectorUI();

            // Load current pet data
            loadCurrentPetData();

            // Initialize all sections
            initializePetData();
            initializeOwnerData();
            initializePathologies();
            initializeMedications();
            initializeSurgeries();
            initializeAllergies();
            initializeVaccines();
            initializeVets();
            initializeLabs();
            initializeNutrition();

            // Initialize UI components
            initializeNavigation();
            initializeSpeciesSelector();
            initializePetPhotoUpload();
            initializeFieldSynchronization();
            initializeActions();

            // Apply current language
            updateUILanguage();

            // Render cloud ID in footer (if cloud storage is configured)
            if (typeof cloudStorage !== 'undefined' && cloudStorage.isReady()) {
                cloudStorage.renderFooterID();
            }

            // Show storage mode indicator (helpful for debugging)
            const storageMode = hybridStorage.getStorageMode();
            if (storageMode === 'memory (restricted)') {
                console.warn('⚠️ App running in restricted storage mode. Data may not persist across sessions.');
            }

            console.log('✅ MHM Mascota Multi - Aplicación lista');
            console.log('📊 Storage info:', petManager.getStorageInfo());
            if (typeof cloudStorage !== 'undefined') {
                console.log('☁️ Cloud ID:', cloudStorage.getCloudId());
            }
        }

        // Start when ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(initMHMApp, 300);
            });
        } else {
            setTimeout(initMHMApp, 300);
        }

        // ==========================================
        // DATA LOADING & RENDERING
        // ==========================================
        let CURRENT_PET_DATA = {}; // Global reference for current pet data

        function loadCurrentPetData() {
            const currentPet = petManager.getCurrentPet();
            if (!currentPet) return;

            CURRENT_PET_DATA = currentPet.data;

            // Update header with pet name
            const currentPetName = document.getElementById('current-pet-name');
            if (currentPetName) {
                currentPetName.textContent = currentPet.name;
            }

            // Update info strip
            const infoPetDisplay = document.getElementById('info-pet-display');
            if (infoPetDisplay) {
                infoPetDisplay.textContent = currentPet.name + (currentPet.breed ? ` (${currentPet.breed})` : '');
            }

            // Update owner info in strip
            const ownerName = currentPet.data?.ownerInfo?.name || '—';
            updateOwnerInHeader(ownerName);

            // Update date
            const infoDate = document.getElementById('info-date');
            if (infoDate) {
                const now = new Date();
                const dateLabel = t('lastUpdate');
                infoDate.innerHTML = `<span data-i18n="lastUpdate">${dateLabel}</span>: ${now.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-CO')}`;
            }
        }

        function updateOwnerInHeader(name) {
            const infoOwner = document.getElementById('info-owner');
            if (infoOwner) {
                infoOwner.innerHTML = `<span data-i18n="owner">${t('owner')}</span>: ${name}`;
            }
        }

        // ==========================================
        // LANGUAGE UI
        // ==========================================
        function initializeLanguageUI() {
            const langButtons = document.querySelectorAll('.lang-btn');

            // Set active button based on current language
            langButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === currentLanguage) {
                    btn.classList.add('active');
                }

                btn.addEventListener('click', function () {
                    const lang = this.dataset.lang;
                    langButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    setLanguage(lang);

                    // Reload data with new language
                    loadCurrentPetData();
                });
            });
        }

        // ==========================================
        // PET SELECTOR UI
        // ==========================================
        function initializePetSelectorUI() {
            const petSelectorBtn = document.getElementById('pet-selector-btn');
            const petSelectorDropdown = document.getElementById('pet-selector-dropdown');
            const petList = document.getElementById('pet-list');
            const petAddBtn = document.getElementById('pet-add-btn');

            if (!petSelectorBtn || !petSelectorDropdown || !petList) return;

            // Toggle dropdown
            petSelectorBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                petSelectorDropdown.classList.toggle('hidden');
                this.classList.toggle('open');
                if (!petSelectorDropdown.classList.contains('hidden')) {
                    renderPetList();
                }
            });

            // Close on click outside
            document.addEventListener('click', function (e) {
                if (!petSelectorBtn.contains(e.target) && !petSelectorDropdown.contains(e.target)) {
                    petSelectorDropdown.classList.add('hidden');
                    petSelectorBtn.classList.remove('open');
                }
            });

            // Add new pet button - IMPROVED
            if (petAddBtn) {
                petAddBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    console.log('➕ Add pet button clicked');

                    if (!petManager.canAddPet()) {
                        const msg = currentLanguage === 'en'
                            ? 'Maximum limit of 5 pets reached'
                            : 'Límite máximo de 5 mascotas alcanzado';
                        alert(msg);
                        return;
                    }

                    const promptMsg = currentLanguage === 'en'
                        ? 'Enter new pet name:'
                        : 'Ingrese el nombre de la nueva mascota:';
                    const newName = prompt(promptMsg);

                    if (newName && newName.trim()) {
                        console.log('Creating pet:', newName.trim());
                        const result = petManager.addPet(newName.trim());

                        if (result.success) {
                            console.log('✅ Pet created, switching...');
                            petManager.switchPet(result.pet.id);
                            window.location.reload();
                        } else {
                            console.log('❌ Failed:', result.message);
                            alert(result.message);
                        }
                    }
                });
            }

            // Initial render
            renderPetList();
        }

        function renderPetList() {
            const petList = document.getElementById('pet-list');
            if (!petList) return;

            const pets = petManager.getAllPets();
            const currentPetId = petManager.getCurrentPet()?.id;

            petList.innerHTML = '';

            pets.forEach(pet => {
                const petItem = document.createElement('div');
                petItem.className = 'pet-item' + (pet.id === currentPetId ? ' active' : '');

                const icon = getSpeciesIcon(pet.data?.petInfo?.species || 'perro');

                petItem.innerHTML = `
            <div class="pet-item-icon">
                <i class="${icon}"></i>
            </div>
            <div class="pet-item-info">
                <div class="pet-item-name">${pet.name}</div>
                <div class="pet-item-species">${pet.species} ${pet.breed ? '• ' + pet.breed : ''}</div>
            </div>
            ${pets.length > 1 ? `<button class="pet-item-delete" data-pet-id="${pet.id}" title="${t('deletePet')}"><i class="fas fa-trash"></i></button>` : ''}
        `;

                // Click to switch pet
                petItem.addEventListener('click', function (e) {
                    if (e.target.closest('.pet-item-delete')) return;
                    if (pet.id !== currentPetId) {
                        petManager.switchPet(pet.id);
                        location.reload();
                    }
                });

                // Delete button
                const deleteBtn = petItem.querySelector('.pet-item-delete');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        if (confirm(t('confirmDelete'))) {
                            const result = petManager.deletePet(pet.id);
                            if (result.success) {
                                location.reload();
                            } else {
                                alert(result.message);
                            }
                        }
                    });
                }

                petList.appendChild(petItem);
            });

            // Show pet count
            const petCount = pets.length;
            const maxPets = 5;
            const countInfo = document.createElement('div');
            countInfo.style.cssText = 'padding: 8px; text-align: center; font-size: 0.75rem; color: #666; border-top: 1px solid #eee;';
            countInfo.textContent = `${petCount}/${maxPets} ${t('myPets')}`;
            petList.appendChild(countInfo);
        }

        function getSpeciesIcon(species) {
            const icons = {
                'perro': 'fas fa-dog',
                'gato': 'fas fa-cat',
                'ave': 'fas fa-dove',
                'conejo': 'fas fa-rabbit',
                'hamster': 'fas fa-paw',
                'otro': 'fas fa-paw'
            };
            return icons[species] || 'fas fa-paw';
        }

        // ==========================================
        // PET DATA
        // ==========================================
        function initializePetData() {
            // First try to get saved data from localStorage via petManager
            const currentPet = petManager.getCurrentPet();
            const savedPetInfo = currentPet?.data?.petInfo;

            // Use saved data if available, otherwise fall back to mock data (for demo)
            const petData = savedPetInfo && savedPetInfo.name
                ? savedPetInfo
                : (typeof PET_DATA !== 'undefined' ? PET_DATA : null);

            if (!petData) {
                // No data available, just set the pet name from petManager
                setFieldValue('pet-name', currentPet?.name || '');
                return;
            }

            setFieldValue('pet-name', petData.name || currentPet?.name || '');
            setFieldValue('pet-microchip', petData.microchip || '');
            setFieldValue('pet-breed', petData.breed || '');
            setFieldValue('pet-color', petData.color || '');
            setFieldValue('pet-dob', petData.dateOfBirth || '');
            setFieldValue('pet-age', petData.age || '');
            setFieldValue('pet-weight', petData.weight || '');
            setSelectValue('pet-size', petData.size);
            setSelectValue('pet-temperament', petData.temperament);
            setSelectValue('pet-activity', petData.activityLevel);
            setFieldValue('pet-behavior-notes', petData.behaviorNotes || '');

            setRadioValue('pet-sex', petData.gender || '');
            setRadioValue('pet-sterilized', petData.sterilized ? 'si' : 'no');
            setRadioValue('pet-social', petData.social || '');

            // Set species
            const speciesValue = (petData.species || 'perro').toLowerCase();
            const speciesOptions = document.querySelectorAll('.species-option');
            speciesOptions.forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.species === speciesValue) {
                    opt.classList.add('active');
                }
            });

            // Update info strip
            updatePetNameInHeader(petData.name || currentPet?.name, petData.breed);

            console.log('📋 Pet data loaded from:', savedPetInfo && savedPetInfo.name ? 'localStorage' : 'mockData');
        }

        // ==========================================
        // OWNER DATA
        // ==========================================
        function initializeOwnerData() {
            // First try to get saved data from localStorage via petManager
            const currentPet = petManager.getCurrentPet();
            const savedOwnerInfo = currentPet?.data?.ownerInfo;

            // Use saved data if available, otherwise fall back to mock data (for demo)
            const ownerData = savedOwnerInfo && savedOwnerInfo.name
                ? savedOwnerInfo
                : (typeof OWNER_DATA !== 'undefined' ? OWNER_DATA : null);

            if (!ownerData) return;

            setFieldValue('owner-name', ownerData.name || '');
            setSelectValue('owner-id-type', ownerData.idType);
            setFieldValue('owner-id', ownerData.idNumber || '');
            setFieldValue('owner-address', ownerData.address || '');
            setFieldValue('owner-city', ownerData.city || '');
            setFieldValue('owner-cell', ownerData.cellPhone || '');
            setFieldValue('owner-phone', ownerData.phone || '');
            setFieldValue('owner-email', ownerData.email || '');

            // Emergency contact
            if (ownerData.emergencyContact) {
                setFieldValue('contact-name', ownerData.emergencyContact.name || '');
                setFieldValue('contact-relation', ownerData.emergencyContact.relation || '');
                setFieldValue('contact-cell', ownerData.emergencyContact.cellPhone || '');
                setFieldValue('contact-phone', ownerData.emergencyContact.phone || '');
                setRadioValue('contact-auth', ownerData.emergencyContact.authorized ? 'si' : 'no');
            }

            // Update header
            updateOwnerInHeader(ownerData.name || '');

            console.log('📋 Owner data loaded from:', savedOwnerInfo && savedOwnerInfo.name ? 'localStorage' : 'mockData');
        }

        // ==========================================
        // PATHOLOGIES
        // ==========================================
        function initializePathologies() {
            const pathologyGroups = {
                'patho-cardio': [
                    { key: 'pathologyHeartMurmur', id: 'heart-murmur' },
                    { key: 'pathologyHeartFailure', id: 'heart-failure' },
                    { key: 'pathologyArrhythmia', id: 'arrhythmia' },
                    { key: 'pathologyChronicCough', id: 'chronic-cough' }
                ],
                'patho-musculo': [
                    { key: 'pathologyHipDysplasia', id: 'hip-dysplasia' },
                    { key: 'pathologyElbowDysplasia', id: 'elbow-dysplasia' },
                    { key: 'pathologyArthritis', id: 'arthritis' },
                    { key: 'pathologyPatellaLuxation', id: 'patella-luxation' },
                    { key: 'pathologyDiscHernia', id: 'disc-hernia' }
                ],
                'patho-digestive': [
                    { key: 'pathologyGastritis', id: 'gastritis' },
                    { key: 'pathologyPancreatitis', id: 'pancreatitis' },
                    { key: 'pathologyIBD', id: 'ibd' },
                    { key: 'pathologyIntestinalParasites', id: 'intestinal-parasites' },
                    { key: 'pathologyFrequentVomiting', id: 'frequent-vomiting' }
                ],
                'patho-skin': [
                    { key: 'pathologyAllergicDermatitis', id: 'allergic-dermatitis' },
                    { key: 'pathologyFungi', id: 'fungi' },
                    { key: 'pathologyMange', id: 'mange' },
                    { key: 'pathologyHotspots', id: 'hotspots' },
                    { key: 'pathologyHairLoss', id: 'hair-loss' }
                ],
                'patho-sensory': [
                    { key: 'pathologyCataracts', id: 'cataracts' },
                    { key: 'pathologyGlaucoma', id: 'glaucoma' },
                    { key: 'pathologyRecurrentOtitis', id: 'recurrent-otitis' },
                    { key: 'pathologyDeafness', id: 'deafness' },
                    { key: 'pathologyConjunctivitis', id: 'conjunctivitis' }
                ],
                'patho-neuro': [
                    { key: 'pathologyEpilepsy', id: 'epilepsy' },
                    { key: 'pathologySeparationAnxiety', id: 'separation-anxiety' },
                    { key: 'pathologyAggression', id: 'aggression' },
                    { key: 'pathologyNoisePhobia', id: 'noise-phobia' },
                    { key: 'pathologyVestibularSyndrome', id: 'vestibular-syndrome' }
                ]
            };

            Object.keys(pathologyGroups).forEach(containerId => {
                const container = document.getElementById(containerId);
                if (!container) return;

                pathologyGroups[containerId].forEach(patho => {
                    const label = document.createElement('label');
                    label.style.cssText = 'display: flex; align-items: center; gap: 8px; padding: 5px 0; font-size: 0.85rem; cursor: pointer;';
                    label.innerHTML = `
                <input type="checkbox" class="mhm-checkbox" id="patho-${patho.id}">
                <span data-i18n="${patho.key}">${t(patho.key)}</span>
            `;
                    container.appendChild(label);
                });
            });

            // Render saved pathologies if they exist
            renderPathologies();
        }

        function renderPathologies() {
            if (typeof PET_PATHOLOGIES === 'undefined') return;

            // Check pathologies for each group
            const groupMap = {
                cardio: 'patho-cardio',
                musculo: 'patho-musculo',
                digestive: 'patho-digestive',
                skin: 'patho-skin',
                sensory: 'patho-sensory',
                neuro: 'patho-neuro'
            };

            Object.keys(groupMap).forEach(key => {
                if (PET_PATHOLOGIES[key]) {
                    PET_PATHOLOGIES[key].forEach(pathoKey => {
                        // Find matching checkbox
                        const checkboxes = document.querySelectorAll(`#${groupMap[key]} input[type="checkbox"]`);
                        checkboxes.forEach(cb => {
                            const label = cb.closest('label');
                            if (label) {
                                const span = label.querySelector('span[data-i18n]');
                                if (span && span.dataset.i18n === pathoKey) {
                                    cb.checked = true;
                                }
                            }
                        });
                    });
                }
            });

            // Set other conditions
            if (PET_PATHOLOGIES.other) {
                setFieldValue('patho-other', PET_PATHOLOGIES.other);
            }
        }

        // ==========================================
        // MEDICATIONS
        // ==========================================
        function initializeMedications() {
            if (typeof PET_MEDICATIONS === 'undefined') return;

            const tbody = document.getElementById('meds-tbody');
            if (!tbody) return;

            PET_MEDICATIONS.forEach(med => {
                const row = createMedicationRow(med);
                tbody.appendChild(row);
            });

            // Add empty rows
            for (let i = 0; i < 3; i++) {
                const row = createMedicationRow({});
                tbody.appendChild(row);
            }

            // Preventives
            if (typeof PET_PREVENTIVES !== 'undefined') {
                if (PET_PREVENTIVES.fleaTick) {
                    setFieldValue('flea-product', PET_PREVENTIVES.fleaTick.product);
                    setFieldValue('flea-date', PET_PREVENTIVES.fleaTick.lastDate);
                    setFieldValue('flea-next', PET_PREVENTIVES.fleaTick.nextDate);
                }
                if (PET_PREVENTIVES.dewormer) {
                    setFieldValue('dewormer-product', PET_PREVENTIVES.dewormer.product);
                    setFieldValue('dewormer-date', PET_PREVENTIVES.dewormer.lastDate);
                    setFieldValue('dewormer-next', PET_PREVENTIVES.dewormer.nextDate);
                }
                if (PET_PREVENTIVES.heartworm) {
                    setFieldValue('heartworm-product', PET_PREVENTIVES.heartworm.product);
                    setFieldValue('heartworm-date', PET_PREVENTIVES.heartworm.lastDate);
                    setFieldValue('heartworm-next', PET_PREVENTIVES.heartworm.nextDate);
                }
            }
        }

        function createMedicationRow(med) {
            const row = document.createElement('tr');
            row.innerHTML = `
        <td><input type="date" class="mhm-input" value="${med.startDate || ''}" style="padding: 4px;"></td>
        <td><input type="text" class="mhm-input" value="${med.name || ''}" placeholder="..." style="padding: 4px;"></td>
        <td><input type="text" class="mhm-input" value="${med.dose || ''}" placeholder="..." style="padding: 4px;"></td>
        <td><input type="text" class="mhm-input" value="${med.frequency || ''}" placeholder="..." style="padding: 4px;"></td>
        <td><input type="text" class="mhm-input" value="${med.reason || ''}" placeholder="..." style="padding: 4px;"></td>
        <td style="text-align: center;"><input type="checkbox" class="mhm-checkbox" ${med.active ? 'checked' : ''}></td>
        <td style="text-align: center;"><input type="checkbox" class="mhm-checkbox" ${med.active === false ? 'checked' : ''}></td>
    `;
            return row;
        }

        // ==========================================
        // SURGERIES
        // ==========================================
        function initializeSurgeries() {
            if (typeof PET_SURGERIES === 'undefined') return;

            const tbody = document.getElementById('surgeries-tbody');
            if (!tbody) return;

            PET_SURGERIES.forEach(surgery => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td><input type="date" class="mhm-input" value="${surgery.date || ''}" style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" value="${surgery.procedure || ''}" style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" value="${surgery.clinic || ''}" style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" value="${surgery.vet || ''}" style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" value="${surgery.notes || ''}" style="padding: 4px;"></td>
        `;
                tbody.appendChild(row);
            });

            // Add empty rows
            for (let i = 0; i < 3; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td><input type="date" class="mhm-input" style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" placeholder="..." style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" placeholder="..." style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" placeholder="..." style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" placeholder="..." style="padding: 4px;"></td>
        `;
                tbody.appendChild(row);
            }

            // Sterilization
            if (typeof PET_STERILIZATION !== 'undefined') {
                setRadioValue('sterilization', PET_STERILIZATION.done ? 'si' : 'no');
                setFieldValue('sterilization-date', PET_STERILIZATION.date);
                setFieldValue('sterilization-clinic', PET_STERILIZATION.clinic);
            }
        }

        // ==========================================
        // ALLERGIES
        // ==========================================
        function initializeAllergies() {
            if (typeof PET_ALLERGIES === 'undefined') return;

            // Food allergies checkboxes
            PET_ALLERGIES.food.forEach(food => {
                const checkbox = document.getElementById(`allergy-${food}`);
                if (checkbox) checkbox.checked = true;
            });

            // Medication allergies
            const medContainer = document.getElementById('med-allergies-container');
            if (medContainer) {
                PET_ALLERGIES.medications.forEach(allergy => {
                    const row = createAllergyRow(allergy.name, allergy.reaction);
                    medContainer.appendChild(row);
                });
                // Add empty rows
                for (let i = 0; i < 4; i++) {
                    const row = createAllergyRow('', '');
                    medContainer.appendChild(row);
                }
            }

            // Environmental allergies
            const envContainer = document.getElementById('env-allergies-container');
            if (envContainer) {
                PET_ALLERGIES.environmental.forEach(allergy => {
                    const row = createAllergyRow(allergy.name, allergy.reaction);
                    envContainer.appendChild(row);
                });
                // Add empty rows
                for (let i = 0; i < 4; i++) {
                    const row = createAllergyRow('', '');
                    envContainer.appendChild(row);
                }
            }

            // Reactions
            setFieldValue('allergy-reactions', PET_ALLERGIES.reactions);
        }

        function createAllergyRow(name, reaction) {
            const row = document.createElement('div');
            row.className = 'mhm-form-row mb-1';
            row.innerHTML = `
        <div class="mhm-form-group" style="flex: 1;">
            <label class="mhm-label" data-i18n="allergen">${t('allergen')}</label>
            <input type="text" class="mhm-input" value="${name}" placeholder="...">
        </div>
        <div class="mhm-form-group" style="flex: 1;">
            <label class="mhm-label" data-i18n="reaction">${t('reaction')}</label>
            <input type="text" class="mhm-input" value="${reaction}" placeholder="...">
        </div>
    `;
            return row;
        }

        // ==========================================
        // VACCINES
        // ==========================================
        function initializeVaccines() {
            if (typeof PET_VACCINES === 'undefined') return;

            // Dog vaccines
            const dogTbody = document.getElementById('dog-vaccines-tbody');
            if (dogTbody) {
                PET_VACCINES.dog.forEach(vax => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td class="text-left" style="font-weight: 600;">${vax.name}</td>
                <td>${vax.dose1 ? `<input type="checkbox" class="mhm-checkbox" checked><br><small>${formatDate(vax.dose1)}</small>` : '<input type="checkbox" class="mhm-checkbox">'}</td>
                <td>${vax.dose2 ? `<input type="checkbox" class="mhm-checkbox" checked><br><small>${formatDate(vax.dose2)}</small>` : vax.dose2 === null ? '' : '<input type="checkbox" class="mhm-checkbox">'}</td>
                <td>${vax.dose3 ? `<input type="checkbox" class="mhm-checkbox" checked><br><small>${formatDate(vax.dose3)}</small>` : vax.dose3 === null ? '' : '<input type="checkbox" class="mhm-checkbox">'}</td>
                <td>${vax.annual ? `<input type="checkbox" class="mhm-checkbox" checked><br><small>${formatDate(vax.annual)}</small>` : '<input type="checkbox" class="mhm-checkbox">'}</td>
                <td><input type="date" class="mhm-input" value="${vax.next || ''}" style="padding: 4px; font-size: 0.75rem;"></td>
            `;
                    dogTbody.appendChild(row);
                });
            }

            // Cat vaccines
            const catTbody = document.getElementById('cat-vaccines-tbody');
            if (catTbody) {
                PET_VACCINES.cat.forEach(vax => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td class="text-left" style="font-weight: 600;">${vax.name}</td>
                <td><input type="checkbox" class="mhm-checkbox"></td>
                <td><input type="checkbox" class="mhm-checkbox"></td>
                <td><input type="checkbox" class="mhm-checkbox"></td>
                <td><input type="date" class="mhm-input" style="padding: 4px; font-size: 0.75rem;"></td>
            `;
                    catTbody.appendChild(row);
                });
            }

            // Vaccine history
            const historyTbody = document.getElementById('vaccine-history-tbody');
            if (historyTbody && typeof VACCINE_HISTORY !== 'undefined') {
                VACCINE_HISTORY.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${formatDate(record.date)}</td>
                <td class="text-left">${record.vaccine}</td>
                <td>${record.lot}</td>
                <td>${record.vet}</td>
                <td>${record.clinic}</td>
                <td>${formatDate(record.nextDate)}</td>
            `;
                    historyTbody.appendChild(row);
                });
            }
        }

        // ==========================================
        // VETERINARIANS
        // ==========================================
        function initializeVets() {
            if (typeof PET_VETS === 'undefined') return;

            const main = PET_VETS.main;
            setFieldValue('vet-main-name', main.name);
            setFieldValue('vet-main-specialty', main.specialty);
            setFieldValue('vet-main-clinic', main.clinic);
            setFieldValue('vet-main-phone', main.phone);
            setFieldValue('vet-main-cell', main.cell);
            setFieldValue('vet-main-address', main.address);
            setFieldValue('vet-main-hours', main.hours);

            // Specialists
            const container = document.getElementById('specialists-container');
            if (container) {
                PET_VETS.specialists.forEach((spec, idx) => {
                    const card = document.createElement('div');
                    card.className = 'mhm-card mb-2';
                    card.innerHTML = `
                <h4 class="mhm-card-title" style="font-size: 0.9rem; color: #666;">
                    <i class="fas fa-user-md"></i> ${t('specialists')} ${idx + 1}: ${spec.specialty}
                </h4>
                <div class="mhm-form-row">
                    <div class="mhm-form-group mhm-form-group--large">
                        <label class="mhm-label" data-i18n="vetName">${t('vetName')}</label>
                        <input type="text" class="mhm-input" value="${spec.name}">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="specialty">${t('specialty')}</label>
                        <input type="text" class="mhm-input" value="${spec.specialty}">
                    </div>
                </div>
                <div class="mhm-form-row">
                    <div class="mhm-form-group mhm-form-group--large">
                        <label class="mhm-label" data-i18n="clinic">${t('clinic')}</label>
                        <input type="text" class="mhm-input" value="${spec.clinic}">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="phone">${t('phone')}</label>
                        <input type="tel" class="mhm-input" value="${spec.phone}">
                    </div>
                    <div class="mhm-form-group">
                        <label class="mhm-label" data-i18n="cellPhone">${t('cellPhone')}</label>
                        <input type="tel" class="mhm-input" value="${spec.cell}">
                    </div>
                </div>
            `;
                    container.appendChild(card);
                });
            }

            // Emergency clinic
            setFieldValue('emergency-clinic', PET_VETS.emergency.name);
            setFieldValue('emergency-phone', PET_VETS.emergency.phone);
            setFieldValue('emergency-address', PET_VETS.emergency.address);
        }

        // ==========================================
        // LABS
        // ==========================================
        function initializeLabs() {
            if (typeof PET_LABS === 'undefined') return;

            const tbody = document.getElementById('labs-tbody');
            if (!tbody) return;

            PET_LABS.forEach(lab => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${formatDate(lab.date)}</td>
            <td class="text-left">${lab.type}</td>
            <td>${lab.lab}</td>
            <td class="text-left">${lab.result}</td>
            <td>${lab.vet}</td>
            <td><button class="mhm-btn" style="padding: 5px 10px; min-width: auto;"><i class="fas fa-paperclip"></i></button></td>
        `;
                tbody.appendChild(row);
            });

            // Add empty rows
            for (let i = 0; i < 3; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td><input type="date" class="mhm-input" style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" placeholder="..." style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" placeholder="..." style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" placeholder="..." style="padding: 4px;"></td>
            <td><input type="text" class="mhm-input" placeholder="..." style="padding: 4px;"></td>
            <td><button class="mhm-btn" style="padding: 5px 10px; min-width: auto;"><i class="fas fa-plus"></i></button></td>
        `;
                tbody.appendChild(row);
            }
        }

        // ==========================================
        // NUTRITION
        // ==========================================
        function initializeNutrition() {
            if (typeof PET_NUTRITION === 'undefined') return;

            const nutr = PET_NUTRITION;

            setSelectValue('food-type', nutr.foodType);
            setFieldValue('food-brand', nutr.brand);
            setFieldValue('food-line', nutr.line);
            setFieldValue('food-quantity', nutr.dailyQuantity);
            setSelectValue('food-frequency', nutr.frequency.toString());

            setRadioValue('gives-snacks', nutr.givesSnacks ? 'si' : 'no');
            setFieldValue('snack-types', nutr.snackTypes);

            setFieldValue('current-weight', nutr.currentWeight);
            setFieldValue('ideal-weight', nutr.idealWeight);
            setSelectValue('body-condition', nutr.bodyCondition.toString());

            setFieldValue('nutrition-notes', nutr.notes);

            // Weight history
            const weightTbody = document.getElementById('weight-history-tbody');
            if (weightTbody) {
                nutr.weightHistory.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${formatDate(record.date)}</td>
                <td style="font-weight: 600;">${record.weight} kg</td>
                <td class="text-left">${record.notes}</td>
            `;
                    weightTbody.appendChild(row);
                });
            }
        }

        // ==========================================
        // PET PHOTO UPLOAD
        // ==========================================
        function initializePetPhotoUpload() {
            const photoContainer = document.getElementById('pet-photo');
            const photoInput = document.getElementById('pet-photo-input');
            const photoBtn = document.getElementById('pet-photo-btn');
            const photoPreview = document.getElementById('pet-photo-preview');

            if (!photoContainer || !photoInput || !photoBtn || !photoPreview) return;

            const cameraIcon = photoContainer.querySelector('i.fa-camera');

            // Click on photo container
            photoContainer.addEventListener('click', () => {
                photoInput.click();
            });

            // Click on button
            photoBtn.addEventListener('click', (e) => {
                e.preventDefault();
                photoInput.click();
            });

            // Handle file selection
            photoInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];

                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();

                    reader.onload = async (event) => {
                        const base64Image = event.target.result;

                        // Show preview immediately
                        photoPreview.src = base64Image;
                        photoPreview.style.display = 'block';
                        if (cameraIcon) {
                            cameraIcon.style.display = 'none';
                        }

                        // Save to pet manager immediately (local storage)
                        petManager.updatePetPhoto(base64Image);
                        console.log('📷 Photo saved to local storage');

                        // Try to upload to cloud in background (non-blocking)
                        if (typeof cloudStorage !== 'undefined' && cloudStorage.isReady()) {
                            // Show uploading indicator
                            photoContainer.style.opacity = '0.7';
                            const originalBtnText = photoBtn.textContent;
                            photoBtn.textContent = '☁️ ' + (t('uploading') || 'Subiendo') + '...';

                            // Upload in background - don't await
                            cloudStorage.uploadImage(base64Image).then(cloudUrl => {
                                photoContainer.style.opacity = '1';
                                if (cloudUrl) {
                                    // Update with cloud URL if successful
                                    petManager.updatePetPhoto(cloudUrl);
                                    photoBtn.textContent = '✅ ' + (t('cloudSaved') || 'En la nube');
                                    setTimeout(() => {
                                        photoBtn.textContent = t('changePhoto') || 'Cambiar Foto';
                                    }, 2000);
                                } else {
                                    // Cloud failed, but local is saved
                                    photoBtn.textContent = '📱 ' + (t('savedLocally') || 'Guardado local');
                                    setTimeout(() => {
                                        photoBtn.textContent = t('changePhoto') || 'Cambiar Foto';
                                    }, 2000);
                                }
                            }).catch(err => {
                                photoContainer.style.opacity = '1';
                                photoBtn.textContent = t('changePhoto') || 'Cambiar Foto';
                                console.warn('☁️ Cloud upload failed silently');
                            });
                        }
                    };

                    reader.readAsDataURL(file);
                } else {
                    alert(t('selectValidImage'));
                }
            });

            // Load photo from pet data if exists
            const currentPet = petManager.getCurrentPet();
            if (currentPet?.data?.petInfo?.photo) {
                photoPreview.src = currentPet.data.petInfo.photo;
                photoPreview.style.display = 'block';
                if (cameraIcon) {
                    cameraIcon.style.display = 'none';
                }
            }
        }

        // ==========================================
        // NAVIGATION
        // ==========================================
        function initializeNavigation() {
            const tabs = document.querySelectorAll('.mhm-tab');
            const contents = document.querySelectorAll('.mhm-tab-content');

            if (tabs.length === 0 || contents.length === 0) return;

            tabs.forEach(tab => {
                tab.style.cursor = 'pointer';
                tab.style.userSelect = 'none';

                tab.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const tabId = this.dataset.tab;
                    if (!tabId) return;

                    // Remove active from all
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.classList.remove('active'));

                    // Add active to clicked
                    this.classList.add('active');

                    // Show corresponding content
                    const target = document.getElementById(`tab-${tabId}`);
                    if (target) {
                        target.classList.add('active');
                    }
                });
            });
        }

        // ==========================================
        // SPECIES SELECTOR
        // ==========================================
        function initializeSpeciesSelector() {
            const speciesOptions = document.querySelectorAll('.species-option');

            speciesOptions.forEach(option => {
                option.addEventListener('click', () => {
                    speciesOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');

                    const species = option.dataset.species;

                    // Show/hide species-specific vaccine cards
                    const dogVax = document.getElementById('dog-vaccines');
                    const catVax = document.getElementById('cat-vaccines');

                    if (dogVax && catVax) {
                        if (species === 'perro') {
                            dogVax.classList.remove('hidden');
                            catVax.classList.add('hidden');
                        } else if (species === 'gato') {
                            dogVax.classList.add('hidden');
                            catVax.classList.remove('hidden');
                        } else {
                            dogVax.classList.add('hidden');
                            catVax.classList.add('hidden');
                        }
                    }
                });
            });
        }

        // ==========================================
        // AUTO-SAVE WITH DEBOUNCE
        // ==========================================
        let autoSaveTimeout = null;

        function autoSaveData() {
            // Cancel any pending save
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }

            // Debounce: wait 1 second after last change before saving
            autoSaveTimeout = setTimeout(() => {
                console.log('💾 Auto-saving data...');
                saveCurrentPetDataSilent();
            }, 1000);
        }

        // Silent save (no alert)
        function saveCurrentPetDataSilent() {
            const currentPet = petManager.getCurrentPet();
            if (!currentPet) return;

            // Collect Pet Info
            const petInfo = {
                name: getVal('pet-name'),
                microchip: getVal('pet-microchip'),
                species: document.querySelector('.species-option.active')?.dataset.species || 'perro',
                breed: getVal('pet-breed'),
                color: getVal('pet-color'),
                dateOfBirth: getVal('pet-dob'),
                gender: getRadioVal('pet-sex'),
                sterilized: getRadioVal('pet-sterilized') === 'si',
                weight: getVal('pet-weight'),
                size: getVal('pet-size'),
                temperament: getVal('pet-temperament'),
                activityLevel: getVal('pet-activity'),
                social: getRadioVal('pet-social'),
                behaviorNotes: getVal('pet-behavior-notes'),
                photo: petManager.getCurrentPet()?.data?.petInfo?.photo || null
            };

            // Collect Owner Info
            const ownerInfo = {
                name: getVal('owner-name'),
                idType: getVal('owner-id-type'),
                idNumber: getVal('owner-id'),
                address: getVal('owner-address'),
                city: getVal('owner-city'),
                cellPhone: getVal('owner-cell'),
                phone: getVal('owner-phone'),
                email: getVal('owner-email'),
                emergencyContact: {
                    name: getVal('contact-name'),
                    relation: getVal('contact-relation'),
                    cellPhone: getVal('contact-cell'),
                    phone: getVal('contact-phone'),
                    authorized: getRadioVal('contact-auth') === 'si'
                }
            };

            // Update data including name at pet level
            const updateData = {
                petInfo: petInfo,
                ownerInfo: ownerInfo
            };

            // Also update the pet name at the top level
            if (petInfo.name) {
                currentPet.name = petInfo.name;
            }
            if (petInfo.species) {
                currentPet.species = petInfo.species;
            }
            if (petInfo.breed) {
                currentPet.breed = petInfo.breed;
            }

            // Save to manager
            petManager.updateCurrentPet(updateData);
            console.log('✅ Auto-saved:', currentPet.name);
        }

        // ==========================================
        // FIELD SYNCHRONIZATION
        // ==========================================
        function initializeFieldSynchronization() {
            // Pet name sync
            const petNameInput = document.getElementById('pet-name');
            if (petNameInput) {
                petNameInput.addEventListener('input', (e) => {
                    updatePetNameInHeader(e.target.value);
                    document.getElementById('current-pet-name').textContent = e.target.value || 'Pet';
                });
            }

            // Pet breed sync
            const petBreedInput = document.getElementById('pet-breed');
            if (petBreedInput) {
                petBreedInput.addEventListener('input', (e) => {
                    updatePetNameInHeader(petNameInput?.value || '', e.target.value);
                });
            }

            // Owner name sync
            const ownerNameInput = document.getElementById('owner-name');
            if (ownerNameInput) {
                ownerNameInput.addEventListener('input', (e) => {
                    updateOwnerInHeader(e.target.value);
                });
            }

            // Date of birth -> age calculation
            const petDobInput = document.getElementById('pet-dob');
            const petAgeInput = document.getElementById('pet-age');
            if (petDobInput && petAgeInput) {
                petDobInput.addEventListener('change', (e) => {
                    const dob = new Date(e.target.value);
                    const today = new Date();

                    if (dob && dob < today) {
                        const ageYears = Math.floor((today - dob) / (365.25 * 24 * 60 * 60 * 1000));
                        const ageMonths = Math.floor(((today - dob) / (30.44 * 24 * 60 * 60 * 1000)) % 12);

                        let ageText = '';
                        if (ageYears > 0) {
                            ageText = `${ageYears} ${ageYears > 1 ? t('years') : t('year')}`;
                            if (ageMonths > 0) {
                                ageText += `, ${ageMonths} ${ageMonths > 1 ? t('months') : t('month')}`;
                            }
                        } else {
                            ageText = `${ageMonths} ${ageMonths > 1 ? t('months') : t('month')}`;
                        }

                        petAgeInput.value = ageText;
                    } else {
                        petAgeInput.value = '';
                    }
                });
            }

            // Weight synchronization
            const petWeightInput = document.getElementById('pet-weight');
            const currentWeightInput = document.getElementById('current-weight');

            if (petWeightInput && currentWeightInput) {
                petWeightInput.addEventListener('input', (e) => {
                    currentWeightInput.value = e.target.value;
                });
                currentWeightInput.addEventListener('input', (e) => {
                    petWeightInput.value = e.target.value;
                });
            }

            // Sterilization sync
            const sterilizedRadios = document.querySelectorAll('input[name="pet-sterilized"]');
            const sterilizationRadios = document.querySelectorAll('input[name="sterilization"]');

            if (sterilizedRadios.length > 0 && sterilizationRadios.length > 0) {
                sterilizedRadios.forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            sterilizationRadios.forEach(r => {
                                if (r.value === e.target.value) r.checked = true;
                            });
                        }
                    });
                });
                sterilizationRadios.forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            sterilizedRadios.forEach(r => {
                                if (r.value === e.target.value) r.checked = true;
                            });
                        }
                    });
                });
            }

            // Update date stamp on changes AND auto-save
            const allInputs = document.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => {
                // For text inputs, use 'input' event for responsive auto-save
                input.addEventListener('input', () => {
                    autoSaveData();
                });

                // For all inputs, update timestamp on change
                input.addEventListener('change', () => {
                    const infoDate = document.getElementById('info-date');
                    if (infoDate) {
                        const now = new Date();
                        infoDate.innerHTML = `<span data-i18n="lastUpdate">${t('lastUpdate')}</span>: ${now.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-CO')} ${now.toLocaleTimeString(currentLanguage === 'en' ? 'en-US' : 'es-CO', { hour: '2-digit', minute: '2-digit' })}`;
                    }
                    // Also trigger auto-save on change (for select, radio, checkbox)
                    autoSaveData();
                });
            });
        }

        function updatePetNameInHeader(name, breed) {
            const infoPetDisplay = document.getElementById('info-pet-display');
            if (infoPetDisplay) {
                const petName = name || t('pet');
                const breedText = breed ? ` (${breed})` : '';
                infoPetDisplay.innerHTML = `<strong>${petName}</strong>${breedText}`;
            }
        }

        // ==========================================
        // ACTIONS
        // ==========================================
        function initializeActions() {
            // Summary button
            const summaryBtn = document.getElementById('btn-summary');
            if (summaryBtn) {
                summaryBtn.addEventListener('click', generateSummary);
            }

            // Save button
            const saveBtn = document.getElementById('btn-save');
            if (saveBtn) {
                saveBtn.addEventListener('click', saveCurrentPetData);
            }

            // Backup button
            const backupBtn = document.getElementById('btn-backup');
            if (backupBtn) {
                backupBtn.addEventListener('click', () => {
                    petManager.exportAllPets();
                });
            }

            // Print button
            const printBtn = document.getElementById('btn-print');
            if (printBtn) {
                printBtn.addEventListener('click', () => {
                    window.print();
                });
            }

            // Exit button
            const exitBtn = document.getElementById('btn-exit');
            if (exitBtn) {
                exitBtn.addEventListener('click', () => {
                    if (confirm(t('confirmExit'))) {
                        alert(t('thankYou'));
                    }
                });
            }

            // Summary modal close
            const summaryClose = document.getElementById('summary-close');
            const summaryModal = document.getElementById('summary-modal');
            if (summaryClose && summaryModal) {
                summaryClose.addEventListener('click', () => {
                    summaryModal.classList.add('hidden');
                });
                summaryModal.addEventListener('click', (e) => {
                    if (e.target === summaryModal) {
                        summaryModal.classList.add('hidden');
                    }
                });
            }
        }

        function generateSummary() {
            const modal = document.getElementById('summary-modal');
            const body = document.getElementById('summary-body');

            if (!modal || !body) return;

            const petName = getVal('pet-name') || PET_DATA?.name || 'Pet';
            const petBreed = getVal('pet-breed') || PET_DATA?.breed || '';
            const petSpecies = document.querySelector('.species-option.active')?.querySelector('span')?.textContent || 'Pet';
            const petWeight = getVal('current-weight') || PET_NUTRITION?.currentWeight || '';
            const petMicrochip = getVal('pet-microchip') || PET_DATA?.microchip || '';
            const petAge = getVal('pet-age') || PET_DATA?.age || '';

            const ownerName = getVal('owner-name') || OWNER_DATA?.name || '';
            const ownerCell = getVal('owner-cell') || OWNER_DATA?.cellPhone || '';
            const ownerEmail = getVal('owner-email') || OWNER_DATA?.email || '';

            const vetName = getVal('vet-main-name') || PET_VETS?.main?.name || '';
            const vetClinic = getVal('vet-main-clinic') || PET_VETS?.main?.clinic || '';
            const vetPhone = getVal('vet-main-phone') || PET_VETS?.main?.phone || '';
            const vetCell = getVal('vet-main-cell') || PET_VETS?.main?.cell || '';

            // Get food allergies
            const foodAllergies = [];
            ['chicken', 'beef', 'wheat', 'corn', 'soy', 'dairy', 'fish', 'eggs'].forEach(food => {
                const cb = document.getElementById(`allergy-${food}`);
                if (cb && cb.checked) {
                    foodAllergies.push(t(food));
                }
            });

            // Get active medications
            const activeMeds = [];
            if (typeof PET_MEDICATIONS !== 'undefined') {
                PET_MEDICATIONS.filter(m => m.active).forEach(m => {
                    activeMeds.push(`<li><strong>${m.name}</strong> - ${m.dose} (${m.frequency})</li>`);
                });
            }

            body.innerHTML = `
        <div style="text-align: center; border-bottom: 2px solid #1b5e20; padding-bottom: 15px; margin-bottom: 20px;">
            <h2 style="margin: 0; color: #1b5e20;"><i class="fas fa-paw"></i> ${t('summaryTitle').toUpperCase()}</h2>
            <p style="margin: 5px 0; color: #666;">${t('summaryOf')} ${petName}</p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <!-- Pet Info -->
            <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #388e3c;">
                <h3 style="margin-top: 0; color: #1b5e20;"><i class="fas fa-dog"></i> ${t('petData')}</h3>
                <p><strong>${t('petName')}:</strong> ${petName}</p>
                <p><strong>${t('species')}/${t('breed')}:</strong> ${petSpecies} - ${petBreed}</p>
                <p><strong>${t('age')}:</strong> ${petAge}</p>
                <p><strong>${t('weight')}:</strong> ${petWeight} kg</p>
                <p><strong>${t('microchip')}:</strong> ${petMicrochip}</p>
            </div>
            
            <!-- Owner Info -->
            <div style="background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #ff7043;">
                <h3 style="margin-top: 0; color: #e64a19;"><i class="fas fa-user"></i> ${t('owner')}</h3>
                <p><strong>${t('fullName')}:</strong> ${ownerName}</p>
                <p><strong>${t('phone')}:</strong> ${ownerCell}</p>
                <p><strong>${t('email')}:</strong> ${ownerEmail}</p>
            </div>
        </div>
        
        <!-- Allergies Alert -->
        <div style="background: #ffebee; padding: 15px; border-radius: 8px; border-left: 4px solid #d32f2f; margin-bottom: 20px;">
            <h3 style="margin-top: 0; color: #c62828;"><i class="fas fa-exclamation-triangle"></i> ${t('alertsAllergies')}</h3>
            ${foodAllergies.length > 0 ? `<p><strong>${t('foods')}:</strong> ${foodAllergies.join(', ')}</p>` : `<p>${t('foods')}: -</p>`}
        </div>
        
        <!-- Medications -->
        <div style="margin-bottom: 20px;">
            <h3 style="background: #e8f5e9; padding: 10px; border-left: 5px solid #388e3c;">
                <i class="fas fa-pills"></i> ${t('currentMeds')}
            </h3>
            <ul style="padding-left: 20px;">
                ${activeMeds.length > 0 ? activeMeds.join('') : '<li>-</li>'}
            </ul>
        </div>
        
        <!-- Vet Info -->
        <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-top: 0; color: #333;"><i class="fas fa-user-md"></i> ${t('mainVet')}</h3>
            <p><strong>${vetName}</strong></p>
            <p>${vetClinic}</p>
            <p>Tel: ${vetPhone} | Cel: ${vetCell}</p>
        </div>
        
        <!-- Footer -->
        <div style="text-align: center; margin-top: 30px; padding-top: 15px; border-top: 1px solid #eee; color: #999; font-size: 0.85rem;">
            ${t('generatedBy')} - ${new Date().toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-CO')}
        </div>
    `;

            modal.classList.remove('hidden');
        }

        // ==========================================
        // DATA SAVING
        // ==========================================
        function saveCurrentPetData() {
            const currentPet = petManager.getCurrentPet();
            if (!currentPet) return;

            // Collect Pet Info
            const petInfo = {
                name: getVal('pet-name'),
                microchip: getVal('pet-microchip'),
                species: document.querySelector('.species-option.active')?.dataset.species || 'perro',
                breed: getVal('pet-breed'),
                color: getVal('pet-color'),
                dateOfBirth: getVal('pet-dob'),
                gender: getRadioVal('pet-sex'),
                sterilized: getRadioVal('pet-sterilized') === 'si',
                weight: getVal('pet-weight'),
                size: getVal('pet-size'),
                temperament: getVal('pet-temperament'),
                activityLevel: getVal('pet-activity'),
                social: getRadioVal('pet-social'),
                behaviorNotes: getVal('pet-behavior-notes')
            };

            // Collect Owner Info
            const ownerInfo = {
                name: getVal('owner-name'),
                idType: getVal('owner-id-type'),
                idNumber: getVal('owner-id'),
                address: getVal('owner-address'),
                city: getVal('owner-city'),
                cellPhone: getVal('owner-cell'),
                phone: getVal('owner-phone'),
                email: getVal('owner-email'),
                emergencyContact: {
                    name: getVal('contact-name'),
                    relation: getVal('contact-relation'),
                    cellPhone: getVal('contact-cell'),
                    phone: getVal('contact-phone'),
                    authorized: getRadioVal('contact-auth') === 'si'
                }
            };

            // Update data
            const updateData = {
                petInfo: petInfo,
                ownerInfo: ownerInfo
            };

            // Save to manager
            petManager.updateCurrentPet(updateData);

            // Feedback
            alert(t('saveSuccess'));
            console.log('Data saved for:', currentPet.name);
        }

        // ==========================================
        // HELPER FUNCTIONS
        // ==========================================
        function setFieldValue(id, value) {
            const el = document.getElementById(id);
            if (el) el.value = value || '';
        }

        function setSelectValue(id, value) {
            const el = document.getElementById(id);
            if (el && value) el.value = value;
        }

        function setRadioValue(name, value) {
            const radio = document.querySelector(`input[name="${name}"][value="${value}"]`);
            if (radio) radio.checked = true;
        }

        function getVal(id) {
            const el = document.getElementById(id);
            return el ? el.value : '';
        }

        function getRadioVal(name) {
            const el = document.querySelector(`input[name="${name}"]:checked`);
            return el ? el.value : '';
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString(currentLanguage === 'en' ? 'en-US' : 'es-CO');
        }

    </script>

</body>

</html>
